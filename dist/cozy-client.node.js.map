{"version":3,"sources":["webpack:///webpack/bootstrap 69f674f53f17ce54eccc","webpack:///external \"isomorphic-fetch\"","webpack:///./src/index.js","webpack:///external \"core-js/modules/es6.typed.data-view\"","webpack:///external \"core-js/modules/es6.typed.int8-array\"","webpack:///external \"core-js/modules/es6.typed.uint8-array\"","webpack:///external \"core-js/modules/es6.typed.uint8-clamped-array\"","webpack:///external \"core-js/modules/es6.typed.int16-array\"","webpack:///external \"core-js/modules/es6.typed.uint16-array\"","webpack:///external \"core-js/modules/es6.typed.int32-array\"","webpack:///external \"core-js/modules/es6.typed.uint32-array\"","webpack:///external \"core-js/modules/es6.typed.float32-array\"","webpack:///external \"core-js/modules/es6.typed.float64-array\"","webpack:///external \"core-js/modules/es6.map\"","webpack:///external \"core-js/modules/es6.set\"","webpack:///external \"core-js/modules/es6.weak-map\"","webpack:///external \"core-js/modules/es6.weak-set\"","webpack:///external \"core-js/modules/es6.reflect.apply\"","webpack:///external \"core-js/modules/es6.reflect.construct\"","webpack:///external \"core-js/modules/es6.reflect.define-property\"","webpack:///external \"core-js/modules/es6.reflect.delete-property\"","webpack:///external \"core-js/modules/es6.reflect.get\"","webpack:///external \"core-js/modules/es6.reflect.get-own-property-descriptor\"","webpack:///external \"core-js/modules/es6.reflect.get-prototype-of\"","webpack:///external \"core-js/modules/es6.reflect.has\"","webpack:///external \"core-js/modules/es6.reflect.is-extensible\"","webpack:///external \"core-js/modules/es6.reflect.own-keys\"","webpack:///external \"core-js/modules/es6.reflect.prevent-extensions\"","webpack:///external \"core-js/modules/es6.reflect.set\"","webpack:///external \"core-js/modules/es6.reflect.set-prototype-of\"","webpack:///external \"core-js/modules/es6.promise\"","webpack:///external \"core-js/modules/es6.symbol\"","webpack:///external \"core-js/modules/es6.object.assign\"","webpack:///external \"core-js/modules/es6.object.is\"","webpack:///external \"core-js/modules/es6.object.set-prototype-of\"","webpack:///external \"core-js/modules/es6.function.name\"","webpack:///external \"core-js/modules/es6.string.raw\"","webpack:///external \"core-js/modules/es6.string.from-code-point\"","webpack:///external \"core-js/modules/es6.string.code-point-at\"","webpack:///external \"core-js/modules/es6.string.repeat\"","webpack:///external \"core-js/modules/es6.string.starts-with\"","webpack:///external \"core-js/modules/es6.string.ends-with\"","webpack:///external \"core-js/modules/es6.string.includes\"","webpack:///external \"core-js/modules/es6.regexp.flags\"","webpack:///external \"core-js/modules/es6.regexp.match\"","webpack:///external \"core-js/modules/es6.regexp.replace\"","webpack:///external \"core-js/modules/es6.regexp.split\"","webpack:///external \"core-js/modules/es6.regexp.search\"","webpack:///external \"core-js/modules/es6.array.from\"","webpack:///external \"core-js/modules/es6.array.of\"","webpack:///external \"core-js/modules/es6.array.copy-within\"","webpack:///external \"core-js/modules/es6.array.find\"","webpack:///external \"core-js/modules/es6.array.find-index\"","webpack:///external \"core-js/modules/es6.array.fill\"","webpack:///external \"core-js/modules/es6.array.iterator\"","webpack:///external \"core-js/modules/es6.number.is-finite\"","webpack:///external \"core-js/modules/es6.number.is-integer\"","webpack:///external \"core-js/modules/es6.number.is-safe-integer\"","webpack:///external \"core-js/modules/es6.number.is-nan\"","webpack:///external \"core-js/modules/es6.number.epsilon\"","webpack:///external \"core-js/modules/es6.number.min-safe-integer\"","webpack:///external \"core-js/modules/es6.number.max-safe-integer\"","webpack:///external \"core-js/modules/es6.math.acosh\"","webpack:///external \"core-js/modules/es6.math.asinh\"","webpack:///external \"core-js/modules/es6.math.atanh\"","webpack:///external \"core-js/modules/es6.math.cbrt\"","webpack:///external \"core-js/modules/es6.math.clz32\"","webpack:///external \"core-js/modules/es6.math.cosh\"","webpack:///external \"core-js/modules/es6.math.expm1\"","webpack:///external \"core-js/modules/es6.math.fround\"","webpack:///external \"core-js/modules/es6.math.hypot\"","webpack:///external \"core-js/modules/es6.math.imul\"","webpack:///external \"core-js/modules/es6.math.log1p\"","webpack:///external \"core-js/modules/es6.math.log10\"","webpack:///external \"core-js/modules/es6.math.log2\"","webpack:///external \"core-js/modules/es6.math.sign\"","webpack:///external \"core-js/modules/es6.math.sinh\"","webpack:///external \"core-js/modules/es6.math.tanh\"","webpack:///external \"core-js/modules/es6.math.trunc\"","webpack:///external \"core-js/modules/es7.array.includes\"","webpack:///external \"core-js/modules/es7.object.values\"","webpack:///external \"core-js/modules/es7.object.entries\"","webpack:///external \"core-js/modules/es7.object.get-own-property-descriptors\"","webpack:///external \"core-js/modules/es7.string.pad-start\"","webpack:///external \"core-js/modules/es7.string.pad-end\"","webpack:///external \"core-js/modules/web.timers\"","webpack:///external \"core-js/modules/web.immediate\"","webpack:///external \"core-js/modules/web.dom.iterable\"","webpack:///external \"regenerator-runtime/runtime\"","webpack:///./src/utils.js","webpack:///./src/auth_storage.js","webpack:///./src/auth_v2.js","webpack:///external \"btoa\"","webpack:///./src/auth_v3.js","webpack:///./src/fetch.js","webpack:///./src/jsonapi.js","webpack:///external \"crypto\"","webpack:///./src/data.js","webpack:///./src/doctypes.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/intents.js","webpack:///./src/offline.js","webpack:///./src/settings.js","webpack:///./src/relations.js"],"names":["auth","data","mango","files","intents","offline","settings","relations","AppTokenV3","AppToken","AccessTokenV3","AccessToken","ClientV3","Client","AuthNone","AuthRunning","AuthError","AuthOK","defaultClientParams","softwareID","dataProto","create","find","update","delete","_delete","updateAttributes","changesFeed","defineIndex","query","addReferencedFiles","listReferencedFiles","destroy","authProto","client","registerClient","updateClient","unregisterClient","getClient","getAuthCodeURL","getAccessToken","refreshToken","filesProto","createDirectory","updateById","updateAttributesById","updateAttributesByPath","trashById","statById","statByPath","downloadById","downloadByPath","getDownloadLinkById","getDownloadLink","getDownloadLinkByPath","getArchiveLink","getFilePath","listTrash","clearTrash","restoreById","destroyById","intentsProto","createService","offlineProto","init","getDoctypes","hasDatabase","getDatabase","createDatabase","destroyDatabase","destroyAllDatabase","hasReplication","replicateFromCozy","stopReplication","stopAllReplication","hasRepeatedReplication","startRepeatedReplication","stopRepeatedReplication","stopAllRepeatedReplication","settingsProto","diskUsage","changePassphrase","getInstance","updateInstance","getClients","deleteClientById","options","AppTokenV2","LocalStorage","MemoryStorage","_inited","_oauth","_token","_authstate","_authcreds","_storage","_version","version","_offline","token","oauth","Error","storage","_clientParams","Object","assign","clientParams","_onRegistered","onRegistered","nopOnRegistered","url","cozyURL","length","slice","_url","disablePromises","addToProto","state","isV2","then","oauthFlow","Promise","resolve","creds","save","CredsKey","path","pathprefix","fetch","res","ok","json","status","datasystem","undefined","protoify","context","fn","prototyped","args","ctx","obj","proto","attr","module","exports","unpromiser","isPromise","isOnline","isOffline","sleep","retry","getFuzzedDelay","getBackedoffDelay","createPath","encodeQuery","decodeQuery","warn","FuzzFactor","value","apply","l","cb","err","navigator","onLine","time","setTimeout","count","delay","doTry","catch","retryDelay","fuzzingFactor","Math","random","retryCount","pow","cozy","doctype","id","route","encodeURIComponent","q","qname","queryIndex","indexOf","queries","fragIndex","queryStr","parts","split","i","pair","decodeURIComponent","hasOwnProperty","warned","text","push","console","prefix","window","localStorage","key","setItem","JSON","stringify","item","getItem","parse","removeItem","hash","deleted","getAppToken","V2TOKEN_ABORT_TIMEOUT","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","appName","e","removeEventListener","clearTimeout","addEventListener","opts","btoa","StateSize","StateKey","clientID","client_id","clientSecret","client_secret","registrationAccessToken","registration_access_token","redirect_uris","redirectURI","software_id","softwareVersion","software_version","clientName","client_name","clientKind","client_kind","clientURI","client_uri","logoURI","logo_uri","policyURI","policy_uri","tokenType","token_type","accessToken","access_token","refresh_token","scope","cli","isRegistered","toRegisterJSON","disableAuth","resetSecret","manualAuthCredentials","createClient","isUnauthorized","isNotFound","oldClient","newClient","shouldPassRegistration","scopes","generateRandomState","join","pageURL","grantQueries","getGrantCodeFromPageURL","retrieveToken","code","tryCount","clearAndRetry","clear","registerNewClient","all","load","credentials","storedState","statePromise","t","body","dontRetry","headers","href","buffer","crypto","getRandomValues","Uint8Array","require","randomBytes","Array","floor","String","fromCharCode","replace","cozyFetch","cozyFetchJSON","fullpath","resp","cozyFetchWithAuth","authorize","handleResponse","toAuthHeader","newToken","saveCredentials","method","handleJSONResponse","contentType","get","FetchError","reason","captureStackTrace","constructor","name","response","defineProperty","message","indexKey","doc","type","findByRef","resources","ref","handleResource","rawResource","links","resource","_id","_type","_rev","meta","rev","attributes","rels","relationships","isArray","map","handleTopLevel","included","forEach","r","NOREV","docType","changes","tries","normalizeDoctype","DOCTYPE_FILES","KNOWN_DOCTYPES","REVERSE_KNOWN","keys","k","isQualified","known","parseSelector","normalizeSelector","makeMapReduceQuery","fields","defineIndexV2","defineIndexV3","indexRef","queryV2","queryV3","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","toString","COUCHDB_INFINITY","COUCHDB_LOWEST","indexName","capitalize","indexDefinition","makeMapFunction","reduce","use_index","selector","limit","since","descending","sort","f","docs","charAt","toUpperCase","operator","acc","concat","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","contentTypeOctetStream","doUpload","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isStream","readable","pipe","isString","checksum","lastModifiedDate","ifMatch","Date","toGMTString","dirID","executable","doUpdateAttributes","attrs","db","children","addIsDir","toJsonApi","extractResponseLinkRelated","related","file","folder","folderPath","endsWith","paths","archive","isDir","contents","clone","intentClass","injectService","element","document","ownerDocument","defaultView","iframe","createElement","setAttribute","classList","add","appendChild","serviceOrigin","handshaken","messageHandler","source","parentNode","removeChild","permissions","createPromise","start","service","services","listenClientData","messageEventListener","terminated","getData","getIntent","terminate","setDatabase","replicationOfflineError","pluginLoaded","doctypes","PouchDB","pouchdbFind","getInfo","database","plugin","createIndexes","createIndex","index","getReplication","replication","setReplication","getReplicationUrl","basic","toBasicAuth","getReplicationPromise","replicationPromise","setReplicationPromise","promise","live","onError","replicate","from","on","info","onComplete","error","cancel","stop","getRepeatedReplication","interval","setRepeatedReplication","timer","setInterval","clearInterval","currentPassPhrase","newPassPhrase","current_passphrase","new_passphrase","instance","ids","refs","makeReferencesPath"],"mappings":"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;;;;ACAA,6D;;;;;;ACAA,uE;;;;;;ACAA,kE;;;;;;ACAA,4E;;;;;;ACAA,6D;;;;;;ACAA,0E;;;;;;ACAA,yD;;;;;;ACAA,wD;;;;;;ACAA,+D;;;;;;ACAA,2D;;;;;;ACAA,yE;;;;;;ACAA,+D;;;;;;ACAA,4D;;;;;;ACAA,wE;;;;;;ACAA,sE;;;;;;ACAA,+D;;;;;;ACAA,oE;;;;;;ACAA,kE;;;;;;ACAA,iE;;;;;;ACAA,8D;;;;;;ACAA,8D;;;;;;ACAA,gE;;;;;;ACAA,8D;;;;;;ACAA,+D;;;;;;ACAA,4D;;;;;;ACAA,0D;;;;;;ACAA,mE;;;;;;ACAA,4D;;;;;;ACAA,kE;;;;;;ACAA,4D;;;;;;ACAA,gE;;;;;;ACAA,kE;;;;;;ACAA,mE;;;;;;ACAA,wE;;;;;;ACAA,+D;;;;;;ACAA,gE;;;;;;ACAA,yE;;;;;;ACAA,yE;;;;;;ACAA,4D;;;;;;ACAA,4D;;;;;;ACAA,4D;;;;;;ACAA,2D;;;;;;ACAA,4D;;;;;;ACAA,2D;;;;;;ACAA,4D;;;;;;ACAA,6D;;;;;;ACAA,4D;;;;;;ACAA,2D;;;;;;ACAA,4D;;;;;;ACAA,4D;;;;;;ACAA,2D;;;;;;ACAA,2D;;;;;;ACAA,2D;;;;;;ACAA,2D;;;;;;ACAA,4D;;;;;;ACAA,gE;;;;;;ACAA,+D;;;;;;ACAA,gE;;;;;;ACAA,qF;;;;;;ACAA,kE;;;;;;ACAA,gE;;;;;;ACAA,wD;;;;;;ACAA,2D;;;;;;ACAA,8D;;;;;;ACAA,yD;;;;;;;;;;;SCGgByD,U,GAAAA,U;SAmBAC,S,GAAAA,S;SAIAC,Q,GAAAA,Q;SAIAC,S,GAAAA,S;SAIAC,K,GAAAA,K;SAMAC,K,GAAAA,K;SAYAC,c,GAAAA,c;SAKAC,iB,GAAAA,iB;SAIAC,U,GAAAA,U;SAeAC,W,GAAAA,W;SAcAC,W,GAAAA,W;SAuCAC,I,GAAAA,I;AAjIhB;AACA,KAAMC,aAAa,GAAnB;;AAEO,UAASZ,UAAT,CAAqBT,EAArB,EAAyB;AAC9B,UAAO,YAAmB;AAAA,uCAANE,IAAM;AAANA,WAAM;AAAA;;AACxB,SAAMoB,QAAQtB,GAAGuB,KAAH,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","file":"cozy-client.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 69f674f53f17ce54eccc","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 1\n// module chunks = 0","/* global fetch */\nimport 'babel-polyfill'\n\nimport {unpromiser, retry, warn} from './utils'\nimport {LocalStorage, MemoryStorage} from './auth_storage'\nimport {AppToken as AppTokenV2, getAppToken as getAppTokenV2} from './auth_v2'\nimport * as auth from './auth_v3'\nimport * as data from './data'\nimport * as mango from './mango'\nimport * as files from './files'\nimport * as intents from './intents'\nimport * as offline from './offline'\nimport * as settings from './settings'\nimport * as relations from './relations'\n\nconst {\n  AppToken: AppTokenV3,\n  AccessToken: AccessTokenV3,\n  Client: ClientV3\n} = auth\n\nconst AuthNone = 0\nconst AuthRunning = 1\nconst AuthError = 2\nconst AuthOK = 3\n\nconst defaultClientParams = {\n  softwareID: 'github.com/cozy/cozy-client-js'\n}\n\nconst dataProto = {\n  create: data.create,\n  find: data.find,\n  update: data.update,\n  delete: data._delete,\n  updateAttributes: data.updateAttributes,\n  changesFeed: data.changesFeed,\n  defineIndex: mango.defineIndex,\n  query: mango.query,\n  addReferencedFiles: relations.addReferencedFiles,\n  listReferencedFiles: relations.listReferencedFiles,\n  destroy: function (...args) {\n    warn('destroy is deprecated, use cozy.data.delete instead.')\n    return data._delete(...args)\n  }\n}\n\nconst authProto = {\n  client: auth.client,\n  registerClient: auth.registerClient,\n  updateClient: auth.updateClient,\n  unregisterClient: auth.unregisterClient,\n  getClient: auth.getClient,\n  getAuthCodeURL: auth.getAuthCodeURL,\n  getAccessToken: auth.getAccessToken,\n  refreshToken: auth.refreshToken\n}\n\nconst filesProto = {\n  create: files.create,\n  createDirectory: files.createDirectory,\n  updateById: files.updateById,\n  updateAttributesById: files.updateAttributesById,\n  updateAttributesByPath: files.updateAttributesByPath,\n  trashById: files.trashById,\n  statById: files.statById,\n  statByPath: files.statByPath,\n  downloadById: files.downloadById,\n  downloadByPath: files.downloadByPath,\n  getDownloadLinkById: files.getDownloadLinkById,\n  getDownloadLink: files.getDownloadLinkByPath, // DEPRECATED, should be removed very soon\n  getDownloadLinkByPath: files.getDownloadLinkByPath,\n  getArchiveLink: files.getArchiveLink,\n  getFilePath: files.getFilePath,\n  listTrash: files.listTrash,\n  clearTrash: files.clearTrash,\n  restoreById: files.restoreById,\n  destroyById: files.destroyById\n}\n\nconst intentsProto = {\n  create: intents.create,\n  createService: intents.createService\n}\n\nconst offlineProto = {\n  init: offline.init,\n  getDoctypes: offline.getDoctypes,\n  // database\n  hasDatabase: offline.hasDatabase,\n  getDatabase: offline.getDatabase,\n  createDatabase: offline.createDatabase,\n  destroyDatabase: offline.destroyDatabase,\n  destroyAllDatabase: offline.destroyAllDatabase,\n  // replication\n  hasReplication: offline.hasReplication,\n  replicateFromCozy: offline.replicateFromCozy,\n  stopReplication: offline.stopReplication,\n  stopAllReplication: offline.stopAllReplication,\n  // repeated replication\n  hasRepeatedReplication: offline.hasRepeatedReplication,\n  startRepeatedReplication: offline.startRepeatedReplication,\n  stopRepeatedReplication: offline.stopRepeatedReplication,\n  stopAllRepeatedReplication: offline.stopAllRepeatedReplication\n}\n\nconst settingsProto = {\n  diskUsage: settings.diskUsage,\n  changePassphrase: settings.changePassphrase,\n  getInstance: settings.getInstance,\n  updateInstance: settings.updateInstance,\n  getClients: settings.getClients,\n  deleteClientById: settings.deleteClientById\n}\n\nclass Client {\n  constructor (options) {\n    this.data = {}\n    this.files = {}\n    this.intents = {}\n    this.offline = {}\n    this.settings = {}\n    this.auth = {\n      Client: ClientV3,\n      AccessToken: AccessTokenV3,\n      AppToken: AppTokenV3,\n      AppTokenV2: AppTokenV2,\n      LocalStorage: LocalStorage,\n      MemoryStorage: MemoryStorage\n    }\n    this._inited = false\n    if (options) {\n      this.init(options)\n    }\n  }\n\n  init (options = {}) {\n    this._inited = true\n    this._oauth = false // is oauth activated or not\n    this._token = null  // application token\n    this._authstate = AuthNone\n    this._authcreds = null\n    this._storage = null\n    this._version = options.version || null\n    this._offline = null\n\n    const token = options.token\n    const oauth = options.oauth\n    if (token && oauth) {\n      throw new Error('Cannot specify an application token with a oauth activated')\n    }\n\n    if (token) {\n      this._token = new AppTokenV3({ token })\n    } else if (oauth) {\n      this._oauth = true\n      this._storage = oauth.storage\n      this._clientParams = Object.assign({}, defaultClientParams, oauth.clientParams)\n      this._onRegistered = oauth.onRegistered || nopOnRegistered\n    }\n\n    let url = options.cozyURL || ''\n    while (url[url.length - 1] === '/') {\n      url = url.slice(0, -1)\n    }\n\n    this._url = url\n\n    const disablePromises = !!options.disablePromises\n    addToProto(this, this.data, dataProto, disablePromises)\n    addToProto(this, this.auth, authProto, disablePromises)\n    addToProto(this, this.files, filesProto, disablePromises)\n    addToProto(this, this.intents, intentsProto, disablePromises)\n    addToProto(this, this.offline, offlineProto, disablePromises)\n    addToProto(this, this.settings, settingsProto, disablePromises)\n\n    if (options.offline) {\n      this.offline.init(options.offline)\n    }\n  }\n\n  authorize () {\n    const state = this._authstate\n    if (state === AuthOK || state === AuthRunning) {\n      return this._authcreds\n    }\n\n    this._authstate = AuthRunning\n    this._authcreds = this.isV2().then((isV2) => {\n      if (isV2 && this._oauth) {\n        throw new Error('OAuth is not supported on the V2 stack')\n      }\n      if (this._oauth) {\n        return auth.oauthFlow(\n          this,\n          this._storage,\n          this._clientParams,\n          this._onRegistered\n        )\n      }\n      // we expect to be on a client side application running in a browser\n      // with cookie-based authentication.\n      if (isV2) {\n        return getAppTokenV2()\n      } else if (this._token) {\n        return Promise.resolve({client: null, token: this._token})\n      } else {\n        throw new Error('Missing application token')\n      }\n    })\n\n    this._authcreds.then(\n      () => { this._authstate = AuthOK },\n      () => { this._authstate = AuthError })\n\n    return this._authcreds\n  }\n\n  saveCredentials (client, token) {\n    const creds = {client, token}\n    if (!this._storage || this._authstate === AuthRunning) {\n      return Promise.resolve(creds)\n    }\n    this._storage.save(auth.CredsKey, creds)\n    this._authcreds = Promise.resolve(creds)\n    return this._authcreds\n  }\n\n  fullpath (path) {\n    return this.isV2().then((isV2) => {\n      const pathprefix = isV2 ? '/ds-api' : ''\n      return this._url + pathprefix + path\n    })\n  }\n\n  isV2 () {\n    if (!this._version) {\n      return retry(() => fetch(`${this._url}/status/`), 3)()\n        .then((res) => {\n          if (!res.ok) {\n            throw new Error('Could not fetch cozy status')\n          } else {\n            return res.json()\n          }\n        })\n        .then((status) => {\n          this._version = status.datasystem !== undefined ? 2 : 3\n          return this.isV2()\n        })\n    }\n    return Promise.resolve(this._version === 2)\n  }\n}\n\nfunction nopOnRegistered () {\n  throw new Error('Missing onRegistered callback')\n}\n\nfunction protoify (context, fn) {\n  return function prototyped (...args) {\n    return fn(context, ...args)\n  }\n}\n\nfunction addToProto (ctx, obj, proto, disablePromises) {\n  for (const attr in proto) {\n    let fn = protoify(ctx, proto[attr])\n    if (disablePromises) {\n      fn = unpromiser(fn)\n    }\n    obj[attr] = fn\n  }\n}\n\nmodule.exports = new Client()\nObject.assign(module.exports, {Client, LocalStorage, MemoryStorage})\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"core-js/modules/es6.typed.data-view\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.data-view\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.int8-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.int8-array\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.uint8-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.uint8-array\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.uint8-clamped-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.uint8-clamped-array\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.int16-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.int16-array\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.uint16-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.uint16-array\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.int32-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.int32-array\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.uint32-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.uint32-array\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.float32-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.float32-array\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.typed.float64-array\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.typed.float64-array\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.map\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.set\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.weak-map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.weak-map\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.weak-set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.weak-set\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.apply\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.apply\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.construct\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.construct\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.define-property\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.define-property\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.delete-property\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.delete-property\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.get\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.get\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.get-own-property-descriptor\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.get-own-property-descriptor\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.get-prototype-of\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.get-prototype-of\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.has\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.has\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.is-extensible\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.is-extensible\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.own-keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.own-keys\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.prevent-extensions\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.prevent-extensions\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.set\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.set\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.reflect.set-prototype-of\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.reflect.set-prototype-of\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.promise\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.symbol\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.symbol\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.object.assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.assign\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.object.is\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.is\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.object.set-prototype-of\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.set-prototype-of\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.function.name\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.function.name\"\n// module id = 35\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.raw\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.raw\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.from-code-point\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.from-code-point\"\n// module id = 37\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.code-point-at\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.code-point-at\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.repeat\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.repeat\"\n// module id = 39\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.starts-with\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.starts-with\"\n// module id = 40\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.ends-with\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.ends-with\"\n// module id = 41\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.string.includes\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.string.includes\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.regexp.flags\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.regexp.flags\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.regexp.match\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.regexp.match\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.regexp.replace\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.regexp.replace\"\n// module id = 45\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.regexp.split\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.regexp.split\"\n// module id = 46\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.regexp.search\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.regexp.search\"\n// module id = 47\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.from\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.from\"\n// module id = 48\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.of\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.of\"\n// module id = 49\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.copy-within\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.copy-within\"\n// module id = 50\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.find\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.find\"\n// module id = 51\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.find-index\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.find-index\"\n// module id = 52\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.fill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.fill\"\n// module id = 53\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.array.iterator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.array.iterator\"\n// module id = 54\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.is-finite\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.is-finite\"\n// module id = 55\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.is-integer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.is-integer\"\n// module id = 56\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.is-safe-integer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.is-safe-integer\"\n// module id = 57\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.is-nan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.is-nan\"\n// module id = 58\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.epsilon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.epsilon\"\n// module id = 59\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.min-safe-integer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.min-safe-integer\"\n// module id = 60\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.number.max-safe-integer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.number.max-safe-integer\"\n// module id = 61\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.acosh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.acosh\"\n// module id = 62\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.asinh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.asinh\"\n// module id = 63\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.atanh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.atanh\"\n// module id = 64\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.cbrt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.cbrt\"\n// module id = 65\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.clz32\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.clz32\"\n// module id = 66\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.cosh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.cosh\"\n// module id = 67\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.expm1\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.expm1\"\n// module id = 68\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.fround\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.fround\"\n// module id = 69\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.hypot\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.hypot\"\n// module id = 70\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.imul\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.imul\"\n// module id = 71\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.log1p\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.log1p\"\n// module id = 72\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.log10\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.log10\"\n// module id = 73\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.log2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.log2\"\n// module id = 74\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.sign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.sign\"\n// module id = 75\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.sinh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.sinh\"\n// module id = 76\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.tanh\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.tanh\"\n// module id = 77\n// module chunks = 0","module.exports = require(\"core-js/modules/es6.math.trunc\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.math.trunc\"\n// module id = 78\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.array.includes\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.array.includes\"\n// module id = 79\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.object.values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.object.values\"\n// module id = 80\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.object.entries\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.object.entries\"\n// module id = 81\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.object.get-own-property-descriptors\"\n// module id = 82\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.string.pad-start\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.string.pad-start\"\n// module id = 83\n// module chunks = 0","module.exports = require(\"core-js/modules/es7.string.pad-end\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es7.string.pad-end\"\n// module id = 84\n// module chunks = 0","module.exports = require(\"core-js/modules/web.timers\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/web.timers\"\n// module id = 85\n// module chunks = 0","module.exports = require(\"core-js/modules/web.immediate\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/web.immediate\"\n// module id = 86\n// module chunks = 0","module.exports = require(\"core-js/modules/web.dom.iterable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/web.dom.iterable\"\n// module id = 87\n// module chunks = 0","module.exports = require(\"regenerator-runtime/runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime/runtime\"\n// module id = 88\n// module chunks = 0","/* global navigator */\nconst FuzzFactor = 0.3\n\nexport function unpromiser (fn) {\n  return function (...args) {\n    const value = fn.apply(this, args)\n    if (!isPromise(value)) {\n      return value\n    }\n    const l = args.length\n    if (l === 0 || typeof args[l - 1] !== 'function') {\n      return\n    }\n    const cb = args[l - 1]\n    value.then(\n      (res) => cb(null, res),\n      (err) => cb(err, null)\n    )\n    return\n  }\n}\n\nexport function isPromise (value) {\n  return !!value && typeof value.then === 'function'\n}\n\nexport function isOnline () {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true\n}\n\nexport function isOffline () {\n  return !isOnline()\n}\n\nexport function sleep (time, args) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, time, args)\n  })\n}\n\nexport function retry (fn, count, delay = 300) {\n  return function doTry (...args) {\n    return fn(...args).catch((err) => {\n      if (--count < 0) {\n        throw err\n      }\n      return sleep(getBackedoffDelay(delay, count))\n        .then(() => doTry(...args))\n    })\n  }\n}\n\nexport function getFuzzedDelay (retryDelay) {\n  const fuzzingFactor = ((Math.random() * 2) - 1) * FuzzFactor\n  return retryDelay * (1.0 + fuzzingFactor)\n}\n\nexport function getBackedoffDelay (retryDelay, retryCount = 1) {\n  return getFuzzedDelay(retryDelay * Math.pow(2, retryCount - 1))\n}\n\nexport function createPath (cozy, isV2, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  const q = encodeQuery(query)\n  if (q !== '') {\n    route += '?' + q\n  }\n  return route\n}\n\nexport function encodeQuery (query) {\n  if (!query) {\n    return ''\n  }\n  let q = ''\n  for (const qname in query) {\n    if (q !== '') {\n      q += '&'\n    }\n    q += `${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`\n  }\n  return q\n}\n\nexport function decodeQuery (url) {\n  let queryIndex = url.indexOf('?')\n  if (queryIndex < 0) {\n    queryIndex = url.length\n  }\n  const queries = {}\n  let fragIndex = url.indexOf('#')\n  if (fragIndex < 0) {\n    fragIndex = url.length\n  }\n  if (fragIndex < queryIndex) {\n    return queries\n  }\n  const queryStr = url.slice(queryIndex + 1, fragIndex)\n  if (queryStr === '') {\n    return queries\n  }\n  const parts = queryStr.split('&')\n  for (let i = 0; i < parts.length; i++) {\n    let pair = parts[i].split('=')\n    if (pair.length === 0 || pair[0] === '') {\n      continue\n    }\n    const qname = decodeURIComponent(pair[0])\n    if (queries.hasOwnProperty(qname)) {\n      continue\n    }\n    if (pair.length === 1) {\n      queries[qname] = true\n    } else if (pair.length === 2) {\n      queries[qname] = decodeURIComponent(pair[1])\n    } else {\n      throw new Error('Malformed URL')\n    }\n  }\n  return queries\n}\n\nconst warned = []\nexport function warn (text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.warn('cozy-client-js', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export class LocalStorage {\n  constructor (storage, prefix) {\n    if (!storage && typeof window !== 'undefined') {\n      storage = window.localStorage\n    }\n    this.storage = storage\n    this.prefix = prefix || 'cozy:oauth:'\n  }\n\n  save (key, value) {\n    return new Promise(resolve => {\n      this.storage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve(value)\n    })\n  }\n\n  load (key) {\n    return new Promise(resolve => {\n      const item = this.storage.getItem(this.prefix + key)\n      if (!item) {\n        resolve()\n      } else {\n        resolve(JSON.parse(item))\n      }\n    })\n  }\n\n  delete (key) {\n    return new Promise(resolve => resolve(\n      this.storage.removeItem(this.prefix + key)))\n  }\n\n  clear () {\n    return new Promise(resolve => {\n      const storage = this.storage\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i)\n        if (key.indexOf(this.prefix) === 0) {\n          storage.removeItem(key)\n        }\n      }\n      resolve()\n    })\n  }\n}\n\nexport class MemoryStorage {\n  constructor () {\n    this.hash = Object.create(null)\n  }\n\n  save (key, value) {\n    this.hash[key] = value\n    return Promise.resolve(value)\n  }\n\n  load (key) {\n    return Promise.resolve(this.hash[key])\n  }\n\n  delete (key) {\n    const deleted = delete this.hash[key]\n    return Promise.resolve(deleted)\n  }\n\n  clear () {\n    this.hash = Object.create(null)\n    return Promise.resolve()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_storage.js","/* global btoa */\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nexport function getAppToken () {\n  return new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      return reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      return reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      return reject(new Error('getV2Token should be used in modern browser'))\n    }\n    const origin = window.location.origin\n    const intent = {action: 'getToken'}\n    let timeout = null\n    const receiver = function (event) {\n      let token\n      try {\n        token = new AppToken({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      } catch (e) {\n        reject(e)\n        return\n      }\n      window.removeEventListener('message', receiver)\n      clearTimeout(timeout)\n      resolve({ client: null, token })\n    }\n    window.addEventListener('message', receiver, false)\n    window.parent.postMessage(intent, origin)\n    timeout = setTimeout(() => {\n      reject(new Error('No response from parent iframe after 3s'))\n    }, V2TOKEN_ABORT_TIMEOUT)\n  })\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.appName = opts.appName || ''\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Basic ' + btoa(`${this.appName}:${this.token}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v2.js","module.exports = require(\"btoa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"btoa\"\n// module id = 92\n// module chunks = 0","/* global btoa */\nimport {encodeQuery, decodeQuery, isOffline} from './utils'\nimport {cozyFetchJSON, FetchError} from './fetch'\n\nconst StateSize = 16\n\nexport const CredsKey = 'creds'\nexport const StateKey = 'state'\n\nexport class Client {\n  constructor (opts) {\n    this.clientID = opts.clientID || opts.client_id || ''\n    this.clientSecret = opts.clientSecret || opts.client_secret || ''\n    this.registrationAccessToken = opts.registrationAccessToken || opts.registration_access_token || ''\n\n    if (opts.redirect_uris) {\n      this.redirectURI = opts.redirect_uris[0] || ''\n    } else {\n      this.redirectURI = opts.redirectURI || ''\n    }\n\n    this.softwareID = opts.softwareID || opts.software_id || ''\n    this.softwareVersion = opts.softwareVersion || opts.software_version || ''\n    this.clientName = opts.clientName || opts.client_name || ''\n    this.clientKind = opts.clientKind || opts.client_kind || ''\n    this.clientURI = opts.clientURI || opts.client_uri || ''\n\n    this.logoURI = opts.logoURI || opts.logo_uri || ''\n    this.policyURI = opts.policyURI || opts.policy_uri || ''\n\n    if (!this.registrationAccessToken) {\n      if (this.redirectURI === '') {\n        throw new Error('Missing redirectURI field')\n      }\n      if (this.softwareID === '') {\n        throw new Error('Missing softwareID field')\n      }\n      if (this.clientName === '') {\n        throw new Error('Missing clientName field')\n      }\n    }\n  }\n\n  isRegistered () {\n    return this.clientID !== ''\n  }\n\n  toRegisterJSON () {\n    return {\n      redirect_uris: [this.redirectURI],\n      software_id: this.softwareID,\n      software_version: this.softwareVersion,\n      client_name: this.clientName,\n      client_kind: this.clientKind,\n      client_uri: this.clientURI,\n      logo_uri: this.logoURI,\n      policy_uri: this.policyURI\n    }\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.registrationAccessToken\n  }\n}\n\nexport class AccessToken {\n  constructor (opts) {\n    this.tokenType = opts.tokenType || opts.token_type\n    this.accessToken = opts.accessToken || opts.access_token\n    this.refreshToken = opts.refreshToken || opts.refresh_token\n    this.scope = opts.scope\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.accessToken\n  }\n\n  toBasicAuth () {\n    return `user:${this.accessToken}@`\n  }\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.token\n  }\n\n  toBasicAuth () {\n    return `user:${this.token}@`\n  }\n}\n\nexport function client (cozy, clientParams) {\n  if (!clientParams) {\n    clientParams = cozy._clientParams\n  }\n  if (clientParams instanceof Client) {\n    return clientParams\n  }\n  return new Client(clientParams)\n}\n\nexport function registerClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (cli.isRegistered()) {\n    return Promise.reject(new Error('Client already registered'))\n  }\n  return cozyFetchJSON(cozy, 'POST', '/auth/register', cli.toRegisterJSON(), {\n    disableAuth: true\n  })\n    .then((data) => new Client(data))\n}\n\nexport function updateClient (cozy, clientParams, resetSecret = false) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  let data = cli.toRegisterJSON()\n  data.client_id = cli.clientID\n  if (resetSecret) data.client_secret = cli.clientSecret\n\n  return cozyFetchJSON(cozy, 'PUT', `/auth/register/${cli.clientID}`, data, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  }).then((data) => createClient(data, cli))\n}\n\nexport function unregisterClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n}\n\n// getClient will retrive the registered client informations from the server.\nexport function getClient (cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  if (isOffline()) {\n    return Promise.resolve(cli)\n  }\n  return cozyFetchJSON(cozy, 'GET', `/auth/register/${cli.clientID}`, null,\n    {\n      manualAuthCredentials: {\n        token: cli\n      }\n    })\n    .then((data) => createClient(data, cli))\n    .catch((err) => {\n      // If we fall into an error while fetching the client (because of a\n      // bad connectivity for instance), we do not bail the whole process\n      // since the client should be able to continue with the persisted\n      // client and token.\n      //\n      // If it is an explicit Unauthorized error though, we bail, clear th\n      // cache and retry.\n      if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n        throw new Error('Client has been revoked')\n      }\n      throw err\n    })\n}\n\n// createClient returns a new Client instance given on object containing the\n// data of the client, from the API, and an old instance of the client.\nfunction createClient (data, oldClient) {\n  const newClient = new Client(data)\n  // we need to keep track of the registrationAccessToken since it is send\n  // only on registration. The GET /auth/register/:client-id endpoint does\n  // not return this token.\n  const shouldPassRegistration = (\n    !!oldClient &&\n    oldClient.registrationAccessToken !== '' &&\n    newClient.registrationAccessToken === ''\n  )\n  if (shouldPassRegistration) {\n    newClient.registrationAccessToken = oldClient.registrationAccessToken\n  }\n  return newClient\n}\n\n// getAuthCodeURL returns a pair {authURL,state} given a registered client. The\n// state should be stored in order to be checked against on the user validation\n// phase.\nexport function getAuthCodeURL (cozy, client, scopes = []) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    throw new Error('Client not registered')\n  }\n  const state = generateRandomState()\n  const query = {\n    'client_id': client.clientID,\n    'redirect_uri': client.redirectURI,\n    'state': state,\n    'response_type': 'code',\n    'scope': scopes.join(' ')\n  }\n  return {\n    url: cozy._url + `/auth/authorize?${encodeQuery(query)}`,\n    state: state\n  }\n}\n\n// getAccessToken perform a request on the access_token entrypoint with the\n// authorization_code grant type in order to generate a new access token for a\n// newly registered client.\n//\n// This method extracts the access code and state from the given URL. By\n// default it uses window.location.href. Also, it checks the given state with\n// the one specified in the URL query parameter to prevent CSRF attacks.\nexport function getAccessToken (cozy, client, state, pageURL = '') {\n  if (!state) {\n    return Promise.reject(new Error('Missing state value'))\n  }\n  const grantQueries = getGrantCodeFromPageURL(pageURL)\n  if (grantQueries === null) {\n    return Promise.reject(new Error('Missing states from current URL'))\n  }\n  if (state !== grantQueries.state) {\n    return Promise.reject(new Error('Given state does not match url query state'))\n  }\n  return retrieveToken(cozy, client, null, {\n    'grant_type': 'authorization_code',\n    'code': grantQueries.code\n  })\n}\n\n// refreshToken perform a request on the access_token entrypoint with the\n// refresh_token grant type in order to refresh the given token.\nexport function refreshToken (cozy, client, token) {\n  return retrieveToken(cozy, client, token, {\n    'grant_type': 'refresh_token',\n    'refresh_token': token.refreshToken\n  })\n}\n\n// oauthFlow performs the stateful registration and access granting of an OAuth\n// client.\nexport function oauthFlow (cozy, storage, clientParams, onRegistered) {\n  let tryCount = 0\n\n  function clearAndRetry (err) {\n    if (tryCount++ > 0) {\n      throw err\n    }\n    return storage.clear().then(() =>\n      oauthFlow(cozy, storage, clientParams, onRegistered))\n  }\n\n  function registerNewClient () {\n    return storage.clear()\n      .then(() => registerClient(cozy, clientParams))\n      .then((client) => {\n        const {url, state} = getAuthCodeURL(cozy, client, clientParams.scopes)\n        return storage.save(StateKey, {client, url, state})\n      })\n  }\n\n  return Promise.all([\n    storage.load(CredsKey),\n    storage.load(StateKey)\n  ])\n  .then(([credentials, storedState]) => {\n    // If credentials are cached we re-fetch the registered client with the\n    // said token. Fetching the client, if the token is outdated we should try\n    // the token is refreshed.\n    if (credentials) {\n      let oldClient, token\n      try {\n        oldClient = new Client(credentials.client)\n        token = new AccessToken(credentials.token)\n      } catch (err) {\n        // bad cache, we should clear and retry the process\n        return clearAndRetry(err)\n      }\n      return getClient(cozy, oldClient)\n        .then((client) => ({client, token}))\n        .catch((err) => {\n          // If we fall into an error while fetching the client (because of a\n          // bad connectivity for instance), we do not bail the whole process\n          // since the client should be able to continue with the persisted\n          // client and token.\n          //\n          // If it is an explicit Unauthorized error though, we bail, clear th\n          // cache and retry.\n          if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n            throw new Error('Client has been revoked')\n          }\n          return { client: oldClient, token }\n        })\n    }\n\n    // Otherwise register a new client if necessary (ie. no client is stored)\n    // and call the onRegistered callback to wait for the user to grant the\n    // access. Finally fetches to access token on success.\n    let statePromise\n    if (!storedState) {\n      statePromise = registerNewClient()\n    } else {\n      statePromise = Promise.resolve(storedState)\n    }\n\n    let client, state, token\n    return statePromise\n      .then((data) => {\n        client = data.client\n        state = data.state\n        return Promise.resolve(onRegistered(client, data.url))\n      })\n      .then((pageURL) => getAccessToken(cozy, client, state, pageURL))\n      .then((t) => { token = t })\n      .then(() => storage.delete(StateKey))\n      .then(() => ({client, token}))\n  })\n  .then(\n    (creds) => storage.save(CredsKey, creds),\n    (err) => {\n      if (FetchError.isUnauthorized(err)) {\n        return clearAndRetry(err)\n      } else {\n        throw err\n      }\n    })\n}\n\n// retrieveToken perform a request on the access_token entrypoint in order to\n// fetch a token.\nfunction retrieveToken (cozy, client, token, query) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  const body = encodeQuery(Object.assign({}, query, {\n    'client_id': client.clientID,\n    'client_secret': client.clientSecret\n  }))\n  return cozyFetchJSON(cozy, 'POST', '/auth/access_token', body, {\n    disableAuth: (token === null),\n    dontRetry: true,\n    manualAuthCredentials: { client, token },\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n  })\n    .then((data) => {\n      data.refreshToken = data.refreshToken || query.refresh_token\n      return new AccessToken(data)\n    })\n}\n\n// getGrantCodeFromPageURL extract the state and access_code query parameters\n// from the given url\nfunction getGrantCodeFromPageURL (pageURL = '') {\n  if (pageURL === '' && typeof window !== 'undefined') {\n    pageURL = window.location.href\n  }\n  const queries = decodeQuery(pageURL)\n  if (!queries.hasOwnProperty('state')) {\n    return null\n  }\n  return {\n    state: queries['state'],\n    code: queries['access_code']\n  }\n}\n\n// generateRandomState will try to generate a 128bits random value from a secure\n// pseudo random generator. It will fallback on Math.random if it cannot find\n// such generator.\nfunction generateRandomState () {\n  let buffer\n  if (typeof window !== 'undefined' &&\n      typeof window.crypto !== 'undefined' &&\n      typeof window.crypto.getRandomValues === 'function') {\n    buffer = new Uint8Array(StateSize)\n    window.crypto.getRandomValues(buffer)\n  } else {\n    try {\n      buffer = require('crypto').randomBytes(StateSize)\n    } catch (e) {}\n  }\n  if (!buffer) {\n    buffer = new Array(StateSize)\n    for (let i = 0; i < buffer.length; i++) {\n      buffer[i] = Math.floor((Math.random() * 255))\n    }\n  }\n  return btoa(String.fromCharCode.apply(null, buffer))\n    .replace(/=+$/, '')\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v3.js","/* global fetch */\nimport {refreshToken, AccessToken} from './auth_v3'\nimport {retry} from './utils'\nimport jsonapi from './jsonapi'\n\nexport function cozyFetch (cozy, path, options = {}) {\n  return cozy.fullpath(path).then((fullpath) => {\n    let resp\n    if (options.disableAuth) {\n      resp = fetch(fullpath, options)\n    } else if (options.manualAuthCredentials) {\n      resp = cozyFetchWithAuth(cozy, fullpath, options, options.manualAuthCredentials)\n    } else {\n      resp = cozy.authorize().then((credentials) =>\n        cozyFetchWithAuth(cozy, fullpath, options, credentials))\n    }\n    return resp.then(handleResponse)\n  })\n}\n\nfunction cozyFetchWithAuth (cozy, fullpath, options, credentials) {\n  if (credentials) {\n    options.headers = options.headers || {}\n    options.headers['Authorization'] = credentials.token.toAuthHeader()\n  }\n\n  // the option credentials:include tells fetch to include the cookies in the\n  // request even for cross-origin requests\n  options.credentials = 'include'\n\n  return Promise.all([\n    cozy.isV2(),\n    fetch(fullpath, options)\n  ]).then(([isV2, res]) => {\n    if ((res.status !== 400 && res.status !== 401) || isV2 || !credentials || options.dontRetry) {\n      return res\n    }\n    // we try to refresh the token only for OAuth, ie, the client defined\n    // and the token is an instance of AccessToken.\n    const { client, token } = credentials\n    if (!client || !(token instanceof AccessToken)) {\n      return res\n    }\n    options.dontRetry = true\n    return retry(() => refreshToken(cozy, client, token), 3)()\n      .then((newToken) => cozy.saveCredentials(client, newToken))\n      .then((credentials) => cozyFetchWithAuth(cozy, fullpath, options, credentials))\n  })\n}\n\nexport function cozyFetchJSON (cozy, method, path, body, options = {}) {\n  options.method = method\n\n  const headers = options.headers = options.headers || {}\n\n  headers['Accept'] = 'application/json'\n\n  if (method !== 'GET' && method !== 'HEAD' && body !== undefined) {\n    if (headers['Content-Type']) {\n      options.body = body\n    } else {\n      headers['Content-Type'] = 'application/json'\n      options.body = JSON.stringify(body)\n    }\n  }\n\n  return cozyFetch(cozy, path, options)\n    .then(handleJSONResponse)\n}\n\nfunction handleResponse (res) {\n  if (res.ok) {\n    return res\n  }\n  let data\n  const contentType = res.headers.get('content-type')\n  if (contentType && contentType.indexOf('json') >= 0) {\n    data = res.json()\n  } else {\n    data = res.text()\n  }\n  return data.then(err => {\n    throw new FetchError(res, err)\n  })\n}\n\nfunction handleJSONResponse (res) {\n  const contentType = res.headers.get('content-type')\n  if (!contentType || contentType.indexOf('json') < 0) {\n    return res.text((data) => {\n      throw new FetchError(res, new Error('Response is not JSON: ' + data))\n    })\n  }\n\n  const json = res.json()\n  if (contentType.indexOf('application/vnd.api+json') === 0) {\n    return json.then(jsonapi)\n  } else {\n    return json\n  }\n}\n\nexport class FetchError extends Error {\n  constructor (res, reason) {\n    super()\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor)\n    }\n    // XXX We have to hardcode this because babel doesn't play nice when extending Error\n    this.name = 'FetchError'\n    this.response = res\n    this.url = res.url\n    this.status = res.status\n    this.reason = reason\n\n    Object.defineProperty(this, 'message', {\n      value: reason.message ||\n        (typeof reason === 'string' ? reason : JSON.stringify(reason))\n    })\n  }\n}\n\nFetchError.isUnauthorized = function (err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 401\n}\n\nFetchError.isNotFound = function (err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 404\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fetch.js","function indexKey (doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef (resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource (rawResource, resources, links) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: (rawResource.meta && rawResource.meta.rev),\n    links: Object.assign({}, rawResource.links, links),\n    attributes: rawResource.attributes,\n    relations: (name) => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel (doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach((r) => handleResource(r, resources, doc.links))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map((r) => handleResource(r, resources, doc.links))\n  } else {\n    return handleResource(doc.data, resources, doc.links)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 96\n// module chunks = 0","import {createPath} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON} from './fetch'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport function create (cozy, doctype, attributes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (isV2) {\n      attributes.docType = doctype\n    }\n    const path = createPath(cozy, isV2, doctype)\n    return cozyFetchJSON(cozy, 'POST', path, attributes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, resp._id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function find (cozy, doctype, id) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n\n    if (!id) {\n      return Promise.reject(new Error('Missing id parameter'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, id)\n    return cozyFetchJSON(cozy, 'GET', path).then((resp) => {\n      if (isV2) {\n        return Object.assign(resp, {_rev: NOREV})\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\nexport function changesFeed (cozy, doctype, options) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const path = createPath(cozy, isV2, doctype, '_changes', options)\n    return cozyFetchJSON(cozy, 'GET', path)\n  })\n}\n\nexport function update (cozy, doctype, doc, changes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    if (isV2) {\n      changes = Object.assign({ _id }, changes)\n    } else {\n      changes = Object.assign({ _id, _rev }, changes)\n    }\n\n    const path = createPath(cozy, isV2, doctype, _id)\n    return cozyFetchJSON(cozy, 'PUT', path, changes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, _id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function updateAttributes (cozy, doctype, _id, changes, tries = 3) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    return find(cozy, doctype, _id)\n      .then((doc) => {\n        return update(cozy, doctype, doc, Object.assign({ _id }, doc, changes))\n      })\n      .catch((err) => {\n        if (tries > 0) {\n          return updateAttributes(cozy, doctype, _id, changes, tries - 1)\n        } else {\n          throw err\n        }\n      })\n  })\n}\n\nexport function _delete (cozy, doctype, doc) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    const query = isV2 ? null : { rev: _rev }\n    const path = createPath(cozy, isV2, doctype, _id, query)\n    return cozyFetchJSON(cozy, 'DELETE', path).then((resp) => {\n      if (isV2) {\n        return {id: _id, rev: NOREV}\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/data.js","import {warn} from './utils'\n\nexport const DOCTYPE_FILES = 'io.cozy.files'\n\nconst KNOWN_DOCTYPES = {\n  'files': DOCTYPE_FILES,\n  'folder': DOCTYPE_FILES,\n  'contact': 'io.cozy.contacts',\n  'event': 'io.cozy.events',\n  'track': 'io.cozy.labs.music.track',\n  'playlist': 'io.cozy.labs.music.playlist'\n}\n\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => {\n  REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k\n})\n\nexport function normalizeDoctype (cozy, isV2, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (!isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn('you are using a non-qualified doctype ' + doctype + ' assumed to be ' + known)\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/doctypes.js","import {warn, createPath} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON} from './fetch'\n\nexport function defineIndex (cozy, doctype, fields) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (!Array.isArray(fields) || fields.length === 0) {\n      throw new Error('defineIndex fields should be a non-empty array')\n    }\n    if (isV2) {\n      return defineIndexV2(cozy, doctype, fields)\n    } else {\n      return defineIndexV3(cozy, doctype, fields)\n    }\n  })\n}\n\nexport function query (cozy, indexRef, options) {\n  return cozy.isV2().then((isV2) => {\n    if (!indexRef) {\n      throw new Error('query should be passed the indexRef')\n    }\n    if (isV2) {\n      return queryV2(cozy, indexRef, options)\n    } else {\n      return queryV3(cozy, indexRef, options)\n    }\n  })\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = (function (doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER'){\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}).toString().replace(/ /g, '').replace(/\\n/g, '')\nconst COUCHDB_INFINITY = {\"\\uFFFF\": \"\\uFFFF\"}\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV2 (cozy, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = { map: makeMapFunction(doctype, fields), reduce: '_count' }\n  let path = `/request/${doctype}/${indexName}/`\n  return cozyFetchJSON(cozy, 'PUT', path, indexDefinition)\n    .then(() => ({ doctype: doctype, type: 'mapreduce', name: indexName, fields: fields }))\n}\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV3 (cozy, doctype, fields) {\n  let path = createPath(cozy, false, doctype, '_index')\n  let indexDefinition = {'index': {fields}}\n  return cozyFetchJSON(cozy, 'POST', path, indexDefinition)\n    .then((response) => ({ doctype: doctype, type: 'mango', name: response.id, fields: fields }))\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nfunction queryV2 (cozy, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error('query indexRef should be the return value of defineIndexV2')\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => response.map(r => r.value))\n}\n\n// queryV3 is equivalent to query but only works for V3\nfunction queryV3 (cozy, indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    since: options.since\n  }\n\n  if (options.descending) {\n    opts.sort = indexRef.fields.map(f => ({ [f]: 'desc' }))\n  }\n\n  let path = createPath(cozy, false, indexRef.doctype, '_find')\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => response.docs)\n}\n\n// misc\nfunction capitalize (name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction (doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace('DOCTYPEPLACEHOLDER', doctype.toLowerCase())\n                     .replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector (selector, path = [], operator = '$eq') {\n  if ((typeof selector) !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function (acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector (selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function (acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector (selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery (indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function (field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error('Selector on field ' + field + ', but not on ' + firstFreeValueField + ' which is higher in index fields.')\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function (field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error('Cant apply selector on ' + field + ', it is not in index')\n    }\n  })\n\n  if (query.descending) {\n    mrquery = {\n      descending: true,\n      reduce: false,\n      startkey: mrquery.endkey,\n      endkey: mrquery.startkey,\n      inclusive_end: mrquery.inclusive_end\n    }\n  }\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global Blob, File */\nimport {cozyFetch, cozyFetchJSON} from './fetch'\nimport jsonapi from './jsonapi'\nimport { DOCTYPE_FILES } from './doctypes'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nfunction doUpload (cozy, data, method, path, options) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer = (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer)\n  const isFile = (typeof File !== 'undefined' && data instanceof File)\n  const isBlob = (typeof Blob !== 'undefined' && data instanceof Blob)\n  const isStream = (data.readable === true && typeof data.pipe === 'function')\n  const isString = (typeof data === 'string')\n\n  if (!isBuffer && !isFile && !isBlob && !isStream && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  let {contentType, checksum, lastModifiedDate, ifMatch} = options || {}\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType = data.type || contentTypeOctetStream\n      if (!lastModifiedDate) {\n        lastModifiedDate = data.lastModifiedDate\n      }\n    } else if (isBlob) {\n      contentType = data.type || contentTypeOctetStream\n    } else if (isStream) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  return cozyFetch(cozy, path, {\n    method: method,\n    headers: {\n      'Content-Type': contentType,\n      'Content-MD5': checksum || '',\n      'Date': lastModifiedDate ? lastModifiedDate.toGMTString() : '',\n      'If-Match': ifMatch || ''\n    },\n    body: data\n  })\n    .then((res) => {\n      const json = res.json()\n      if (!res.ok) {\n        return json.then(err => { throw err })\n      } else {\n        return json.then(jsonapi)\n      }\n    })\n}\n\nexport function create (cozy, data, options) {\n  let {name, dirID, executable} = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (executable === undefined) {\n    executable = false\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=file&Executable=${executable}`\n  return doUpload(cozy, data, 'POST', `${path}${query}`, options)\n}\n\nexport function createDirectory (cozy, options) {\n  let {name, dirID, lastModifiedDate} = options || {}\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return cozyFetchJSON(cozy, 'POST', `${path}${query}`, undefined, {\n    headers: {\n      'Date': lastModifiedDate ? lastModifiedDate.toGMTString() : ''\n    }\n  })\n}\n\nexport function updateById (cozy, id, data, options) {\n  return doUpload(cozy, data, 'PUT', `/files/${encodeURIComponent(id)}`, options)\n}\n\nfunction doUpdateAttributes (cozy, attrs, path, options) {\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const {ifMatch} = options || {}\n  const body = { data: { attributes: attrs } }\n  return cozyFetchJSON(cozy, 'PATCH', path, body, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function updateAttributesById (cozy, id, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/${encodeURIComponent(id)}`, options)\n}\n\nexport function updateAttributesByPath (cozy, path, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/metadata?Path=${encodeURIComponent(path)}`, options)\n}\n\nexport function trashById (cozy, id) {\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/files/${encodeURIComponent(id)}`)\n}\n\nexport function statById (cozy, id, offline = true) {\n  if (offline && cozy.offline.hasDatabase(DOCTYPE_FILES)) {\n    let db = cozy.offline.getDatabase(DOCTYPE_FILES)\n    return Promise.all([\n      db.get(id),\n      db.find({selector: {'dir_id': id}})\n    ]).then(([doc, children]) => {\n      children = children.docs.map(doc => addIsDir(toJsonApi(cozy, doc)))\n      return addIsDir(toJsonApi(cozy, doc, children))\n    })\n  }\n  return cozyFetchJSON(cozy, 'GET', `/files/${encodeURIComponent(id)}`)\n    .then(addIsDir)\n}\n\nexport function statByPath (cozy, path) {\n  return cozyFetchJSON(cozy, 'GET', `/files/metadata?Path=${encodeURIComponent(path)}`)\n    .then(addIsDir)\n}\n\nexport function downloadById (cozy, id) {\n  return cozyFetch(cozy, `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport function downloadByPath (cozy, path) {\n  return cozyFetch(cozy, `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction extractResponseLinkRelated (res) {\n  let href = res.links && res.links.related\n  if (!href) throw new Error('No related link in server response')\n  return href\n}\n\nexport function getDownloadLinkByPath (cozy, path) {\n  return cozyFetchJSON(cozy, 'POST', `/files/downloads?Path=${encodeURIComponent(path)}`)\n    .then(extractResponseLinkRelated)\n}\n\nexport function getDownloadLinkById (cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/downloads?Id=${encodeURIComponent(id)}`)\n    .then(extractResponseLinkRelated)\n}\n\nexport function getFilePath (cozy, file = {}, folder) {\n  if (!folder || !folder.attributes) {\n    throw Error('Folder should be valid with an attributes.path property')\n  }\n\n  const folderPath = folder.attributes.path.endsWith('/')\n    ? folder.attributes.path\n      : `${folder.attributes.path}/`\n\n  return `${folderPath}${file.name}`\n}\n\nexport function getArchiveLink (cozy, paths, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      files: paths\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, {data: archive})\n  .then(extractResponseLinkRelated)\n}\n\nexport function listTrash (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/files/trash`)\n}\n\nexport function clearTrash (cozy) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash`)\n}\n\nexport function restoreById (cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nexport function destroyById (cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nfunction addIsDir (obj) {\n  obj.isDir = obj.attributes.type === 'directory'\n  return obj\n}\n\nfunction toJsonApi (cozy, doc, contents = []) {\n  let clone = JSON.parse(JSON.stringify(doc))\n  delete clone._id\n  delete clone._rev\n  return {\n    _id: doc._id,\n    _rev: doc._rev,\n    _type: DOCTYPE_FILES,\n    attributes: clone,\n    relations: (name) => {\n      if (name === 'contents') {\n        return contents\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","import {cozyFetchJSON} from './fetch'\n\nconst intentClass = 'coz-intent'\n\n// inject iframe for service in given element\nfunction injectService (url, element, data) {\n  const document = element.ownerDocument\n  if (!document) throw new Error('Cannot retrieve document object from given element')\n\n  const window = document.defaultView\n  if (!window) throw new Error('Cannot retrieve window object from document')\n\n  const iframe = document.createElement('iframe')\n  iframe.setAttribute('src', url)\n  iframe.classList.add(intentClass)\n  element.appendChild(iframe)\n\n  // Keeps only http://domain:port/\n  const serviceOrigin = url.split('/', 3).join('/')\n\n  return new Promise((resolve, reject) => {\n    let handshaken = false\n    const messageHandler = (event) => {\n      if (event.origin !== serviceOrigin) return\n\n      if (event.data === 'intent:ready') {\n        handshaken = true\n        return event.source.postMessage(data, event.origin)\n      }\n\n      window.removeEventListener('message', messageHandler)\n      iframe.parentNode.removeChild(iframe)\n\n      if (event.data === 'intent:error') {\n        return reject(new Error('Intent error'))\n      }\n\n      return handshaken\n        ? resolve(event.data)\n        : reject(new Error('Unexpected handshake message from intent service'))\n    }\n\n    window.addEventListener('message', messageHandler)\n  })\n}\n\nexport function create (cozy, action, type, data = {}, permissions = []) {\n  if (!action) throw new Error(`Misformed intent, \"action\" property must be provided`)\n  if (!type) throw new Error(`Misformed intent, \"type\" property must be provided`)\n\n  const createPromise = cozyFetchJSON(cozy, 'POST', '/intents', {\n    data: {\n      type: 'io.cozy.intents',\n      attributes: {\n        action: action,\n        type: type,\n        data: data,\n        permissions: permissions\n      }\n    }\n  })\n\n  createPromise.start = (element) => {\n    return createPromise.then(intent => {\n      let service = intent.attributes.services && intent.attributes.services[0]\n\n      if (!service) {\n        return Promise.reject(new Error('Unable to find a service'))\n      }\n\n      return injectService(service.href, element, data)\n    })\n  }\n\n  return createPromise\n}\n\nfunction listenClientData (intent, window) {\n  return new Promise((resolve, reject) => {\n    const messageEventListener = (event) => {\n      if (event.origin !== intent.attributes.client) return\n\n      window.removeEventListener('message', messageEventListener)\n      resolve(event.data)\n    }\n\n    window.addEventListener('message', messageEventListener)\n    window.parent.postMessage('intent:ready', intent.attributes.client)\n  })\n}\n\n// returns a service to communicate with intent client\nexport function createService (cozy, id, window) {\n  return cozyFetchJSON(cozy, 'GET', `/intents/${id}`)\n    .then(intent => {\n      return listenClientData(intent, window)\n        .then(data => {\n          let terminated = false\n          return {\n            getData: () => data,\n            getIntent: () => intent,\n            terminate: (doc) => {\n              if (terminated) throw new Error('Intent service has already been terminated')\n              terminated = true\n              window.parent.postMessage(doc, intent.attributes.client)\n            }\n          }\n        })\n    })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents.js","/* global PouchDB, pouchdbFind */\nimport {DOCTYPE_FILES} from './doctypes'\nimport {refreshToken} from './auth_v3'\nimport {isOffline} from './utils'\n\nexport const replicationOfflineError = 'Replication abort, your device is actually offline.'\n\nlet pluginLoaded = false\n\n/*\n  For each doctype we have some parameters:\n  cozy._offline[doctype] = {\n    database: pouchdb database\n    replication: the pouchdb replication\n    replicationPromise: promise of replication\n    interval: repeated replication interval\n  }\n*/\n\nexport function init (cozy, { options = {}, doctypes = [] }) {\n  if (typeof PouchDB === 'undefined') throw new Error('Missing pouchdb dependency for offline mode. Please run \"yarn add pouchdb\" and provide PouchDB as a webpack plugin.')\n  if (typeof pouchdbFind === 'undefined') throw new Error('Missing pouchdb-find dependency for offline mode. Please run \"yarn add pouchdb-find\" and provide pouchdbFind as webpack plugin.')\n  for (let doctype of doctypes) {\n    createDatabase(cozy, doctype, options)\n  }\n}\n\n// helper\n\nfunction getInfo (cozy, doctype) {\n  cozy._offline = cozy._offline || []\n  cozy._offline[doctype] = cozy._offline[doctype] || {}\n  return cozy._offline[doctype]\n}\n\nexport function getDoctypes (cozy) {\n  cozy._offline = cozy._offline || []\n  return Object.keys(cozy._offline)\n}\n\n//\n// DATABASE\n//\n\nexport function hasDatabase (cozy, doctype) {\n  return getDatabase(cozy, doctype) !== undefined\n}\n\nexport function getDatabase (cozy, doctype) {\n  return getInfo(cozy, doctype).database\n}\n\nexport function setDatabase (cozy, doctype, database) {\n  cozy._offline[doctype].database = database\n  return getDatabase(cozy, doctype)\n}\n\nexport function createDatabase (cozy, doctype, options = {}) {\n  if (!pluginLoaded) {\n    PouchDB.plugin(pouchdbFind)\n    pluginLoaded = true\n  }\n\n  if (hasDatabase(cozy, doctype)) {\n    return Promise.resolve(getDatabase(cozy, doctype))\n  }\n\n  setDatabase(cozy, doctype, new PouchDB(doctype, options))\n  return createIndexes(cozy, doctype).then(() => getDatabase(cozy, doctype))\n}\n\nexport function destroyDatabase (cozy, doctype) {\n  if (!hasDatabase(cozy, doctype)) {\n    return Promise.resolve(false)\n  }\n\n  return stopRepeatedReplication(cozy, doctype)\n    .then(() => stopReplication(cozy, doctype))\n    .then(() => getDatabase(cozy, doctype).destroy())\n    .then(response => {\n      setDatabase(cozy, doctype, undefined)\n      return response\n    })\n}\n\nexport function destroyAllDatabase (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const destroy = (doctype) => destroyDatabase(cozy, doctype)\n  return Promise.all(doctypes.map(destroy))\n}\n\nfunction createIndexes (cozy, doctype) {\n  if (doctype === DOCTYPE_FILES) {\n    return getDatabase(cozy, doctype).createIndex({index: {fields: ['dir_id']}})\n  }\n  return Promise.resolve()\n}\n\n//\n// REPLICATION\n//\n\nexport function hasReplication (cozy, doctype) {\n  return getReplication(cozy, doctype) !== undefined\n}\n\nfunction getReplication (cozy, doctype) {\n  return getInfo(cozy, doctype).replication\n}\n\nfunction setReplication (cozy, doctype, replication) {\n  cozy._offline[doctype].replication = replication\n  return getReplication(cozy, doctype)\n}\n\nfunction getReplicationUrl (cozy, doctype) {\n  return cozy.authorize()\n    .then(credentials => {\n      const basic = credentials.token.toBasicAuth()\n      return (cozy._url + '/data/' + doctype).replace('//', `//${basic}`)\n    })\n}\n\nfunction getReplicationPromise (cozy, doctype) {\n  return getInfo(cozy, doctype).replicationPromise\n}\n\nfunction setReplicationPromise (cozy, doctype, promise) {\n  cozy._offline[doctype].replicationPromise = promise\n  return getReplicationPromise(cozy, doctype)\n}\n\nexport function replicateFromCozy (cozy, doctype, options = {}) {\n  return setReplicationPromise(cozy, doctype, new Promise((resolve, reject) => {\n    if (!hasDatabase(cozy, doctype)) {\n      createDatabase(cozy, doctype)\n    }\n    if (options.live === true) {\n      return reject(new Error('You can\\'t use `live` option with Cozy couchdb.'))\n    }\n\n    if (isOffline()) {\n      reject(replicationOfflineError)\n      options.onError && options.onError(replicationOfflineError)\n      return\n    }\n\n    getReplicationUrl(cozy, doctype)\n      .then(url => setReplication(cozy, doctype,\n        getDatabase(cozy, doctype).replicate.from(url, options).on('complete', (info) => {\n          setReplication(cozy, doctype, undefined)\n          resolve(info)\n          options.onComplete && options.onComplete(info)\n        }).on('error', (err) => {\n          if (err.error === 'code=400, message=Expired token') {\n            cozy.authorize().then(({client, token}) => {\n              refreshToken(cozy, client, token)\n                .then((newToken) => cozy.saveCredentials(client, newToken))\n                .then((credentials) => replicateFromCozy(cozy, doctype, options))\n            })\n          } else {\n            console.warn(`ReplicateFromCozy '${doctype}' Error:`)\n            console.warn(err)\n            setReplication(cozy, doctype, undefined)\n            reject(err)\n            options.onError && options.onError(err)\n          }\n        })\n      ))\n  }))\n}\n\nexport function stopReplication (cozy, doctype) {\n  if (!getDatabase(cozy, doctype) || !hasReplication(cozy, doctype)) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    try {\n      getReplicationPromise(cozy, doctype).then(() => {\n        resolve()\n      })\n      getReplication(cozy, doctype).cancel()\n      // replication is set to undefined by complete replication\n    } catch (e) {\n      resolve()\n    }\n  })\n}\n\nexport function stopAllReplication (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = (doctype) => stopReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n//\n// REPEATED REPLICATION\n//\n\nfunction getRepeatedReplication (cozy, doctype) {\n  return getInfo(cozy, doctype).interval\n}\n\nfunction setRepeatedReplication (cozy, doctype, interval) {\n  cozy._offline[doctype].interval = interval\n}\n\nexport function hasRepeatedReplication (cozy, doctype) {\n  return getRepeatedReplication(cozy, doctype) !== undefined\n}\n\nexport function startRepeatedReplication (cozy, doctype, timer, options = {}) {\n  // TODO: add timer limitation for not flooding Gozy\n  if (hasRepeatedReplication(cozy, doctype)) {\n    return getRepeatedReplication(cozy, doctype)\n  }\n\n  return setRepeatedReplication(cozy, doctype, setInterval(() => {\n    if (isOffline()) {\n      // network is offline, replication cannot be launched\n      console.info(replicationOfflineError)\n      return\n    }\n    if (!hasReplication(cozy, doctype)) {\n      replicateFromCozy(cozy, doctype, options)\n      // TODO: add replicationToCozy\n    }\n  }, timer * 1000))\n}\n\nexport function stopRepeatedReplication (cozy, doctype) {\n  if (hasRepeatedReplication(cozy, doctype)) {\n    clearInterval(getRepeatedReplication(cozy, doctype))\n    setRepeatedReplication(cozy, doctype, undefined)\n  }\n  if (hasReplication(cozy, doctype)) {\n    return stopReplication(cozy, doctype)\n  }\n\n  return Promise.resolve()\n}\n\nexport function stopAllRepeatedReplication (cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = (doctype) => stopRepeatedReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/offline.js","import {cozyFetchJSON} from './fetch'\n\nexport function diskUsage (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/disk-usage`)\n}\n\nexport function changePassphrase (cozy, currentPassPhrase, newPassPhrase) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/passphrase`, {\n    current_passphrase: currentPassPhrase,\n    new_passphrase: newPassPhrase\n  })\n}\n\nexport function getInstance (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/instance`)\n}\n\nexport function updateInstance (cozy, instance) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/instance`, instance)\n}\n\nexport function getClients (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/clients`)\n}\n\nexport function deleteClientById (cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/settings/clients/${id}`)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import {cozyFetchJSON} from './fetch'\nimport { DOCTYPE_FILES } from './doctypes'\n\nexport function addReferencedFiles (cozy, doc, ids) {\n  if (!doc) throw new Error('missing doc argument')\n  if (!Array.isArray(ids)) ids = [ids]\n\n  const refs = ids.map((id) => ({type: DOCTYPE_FILES, id: id}))\n\n  return cozyFetchJSON(cozy, 'POST', makeReferencesPath(doc), {data: refs})\n}\n\nexport function listReferencedFiles (cozy, doc) {\n  if (!doc) throw new Error('missing doc argument')\n  return cozyFetchJSON(cozy, 'GET', makeReferencesPath(doc))\n    .then((files) => files.map((file) => file._id))\n}\n\nfunction makeReferencesPath (doc) {\n  const type = encodeURIComponent(doc._type)\n  const id = encodeURIComponent(doc._id)\n  return `/data/${type}/${id}/relationships/references`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/relations.js"],"sourceRoot":""}