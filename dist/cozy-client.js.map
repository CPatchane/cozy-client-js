{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 99ec443de7c5d59571d1","webpack:///./~/whatwg-fetch/fetch.js","webpack:///./~/regenerator-runtime/runtime.js","webpack:///./src/index.js","webpack:///./src/crud.js","webpack:///./src/utils.js","webpack:///./src/jsonapi.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/init.js"],"names":["crud","mango","files","filesProto","create","data","options","optCallback","createDirectory","updateById","id","updateAttributesById","attrs","updateAttributesByPath","path","trashById","statById","statByPath","downloadById","downloadByPath","cozy","init","opts","doctype","attributes","find","update","doc","changes","delete","_delete","defineIndex","indexDef","query","indexRef","updateAttribute","updateAttributes","destroy","window","config","isV2","docType","response","_id","Error","Object","assign","_rev","NOREV","tries","updated","rev","nocompat","waitConfig","configure","promiser","createPath","doFetch","doFetchJSON","normalizeDoctype","warn","promise","then","result","err","route","encodeURIComponent","q","qname","push","join","method","body","headers","undefined","JSON","stringify","auth","appName","token","btoa","target","pathprefix","fullpath","fetch","res","ok","contentType","get","indexOf","json","text","KNOWN_DOCTYPES","REVERSE_KNOWN","keys","forEach","k","isQualified","known","replace","isV3","warned","console","log","indexKey","type","findByRef","resources","ref","handleResource","rawResource","resource","_type","meta","relations","name","rels","relationships","Array","isArray","map","handleTopLevel","included","r","fields","length","defineIndexV2","defineIndexV3","queryV2","queryV3","indexName","capitalize","indexDefinition","makeMapFunction","reduce","makeMapReduceQuery","value","use_index","selector","limit","since","sort","docs","parseSelector","normalizeSelector","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","toString","COUCHDB_INFINITY","COUCHDB_LOWEST","charAt","toUpperCase","slice","operator","acc","concat","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","buffer","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isString","contentTypeOctetStream","doUpload","dirID","isDir","obj","getV3Token","status","datasystem","getV2Token","getAuth","V2TOKEN_ABORT_TIMEOUT","Promise","resolve","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","removeEventListener","clearTimeout","addEventListener","setTimeout"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;ACtCA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;;AAEA;AACA;AACA,yCAAwC,mBAAmB;AAC3D;AACA;;AAEA;AACA;AACA,mCAAkC,oBAAoB;AACtD;AACA;;AAEA;AACA;AACA,yCAAwC,4BAA4B;AACpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA,wDAAuD;AACvD,UAAS;AACT;AACA,UAAS;AACT,+EAA8E;AAC9E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA,wCAAuC,0BAA0B;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,0BAA0B,eAAe;AACxE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA,EAAC;;;;;;;AChbD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc;AACd,MAAK;AACL,eAAc;AACd;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA,YAAW;AACX;;AAEA;AACA;AACA,yCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,4BAA2B;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAS;AACT;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;;AAEA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kCAAiC,kBAAkB;AACnD;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,kBAAiB;;AAEjB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAwB,iBAAiB;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,aAAY;AACZ;AACA;;AAEA;AACA,aAAY;AACZ;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,QAAQ;AACtD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;;AAEA,YAAW;AACX;AACA;AACA;;AAEA,YAAW;AACX;AACA;AACA;;AAEA,YAAW;AACX;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1pBA;;KAAYA,I;;AACZ;;KAAYC,K;;AACZ;;KAAYC,K;;AACZ;;;;AACA;;;;;;AAEA,KAAIC,aAAa;AACfC,WAAQ,gBAAUC,IAAV,EAAgBC,OAAhB,EAAyBC,WAAzB,EAAsC;AAC5C,YAAO,qBAASL,MAAME,MAAN,CAAaC,IAAb,EAAmBC,OAAnB,CAAT,EAAsCC,WAAtC,CAAP;AACD,IAHc;AAIfC,oBAAiB,yBAAUF,OAAV,EAAmBC,WAAnB,EAAgC;AAC/C,YAAO,qBAASL,MAAMM,eAAN,CAAsBF,OAAtB,CAAT,EAAyCC,WAAzC,CAAP;AACD,IANc;AAOfE,eAAY,oBAAUC,EAAV,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","file":"cozy-client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cozy-client-js\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cozy-client-js\"] = factory();\n\telse\n\t\troot[\"cozy-client-js\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 99ec443de7c5d59571d1","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 1\n// module chunks = 0","/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype;\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] = GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof process === \"object\" && process.domain) {\n      invoke = process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          if (method === \"return\" ||\n              (method === \"throw\" && delegate.iterator[method] === undefined)) {\n            // A return or throw (when the delegate iterator has no throw\n            // method) always terminates the yield* loop.\n            context.delegate = null;\n\n            // If the delegate iterator has a return method, give it a\n            // chance to clean up.\n            var returnMethod = delegate.iterator[\"return\"];\n            if (returnMethod) {\n              var record = tryCatch(returnMethod, delegate.iterator, arg);\n              if (record.type === \"throw\") {\n                // If the return method threw an exception, let that\n                // exception prevail over the original return or throw.\n                method = \"throw\";\n                arg = record.arg;\n                continue;\n              }\n            }\n\n            if (method === \"return\") {\n              // Continue with the outer return, now that the delegate\n              // iterator has been terminated.\n              continue;\n            }\n          }\n\n          var record = tryCatch(\n            delegate.iterator[method],\n            delegate.iterator,\n            arg\n          );\n\n          if (record.type === \"throw\") {\n            context.delegate = null;\n\n            // Like returning generator.throw(uncaught), but without the\n            // overhead of an extra function call.\n            method = \"throw\";\n            arg = record.arg;\n            continue;\n          }\n\n          // Delegate generator ran and handled its own exceptions so\n          // regardless of what the method was, we continue as if it is\n          // \"next\" with an undefined arg.\n          method = \"next\";\n          arg = undefined;\n\n          var info = record.arg;\n          if (info.done) {\n            context[delegate.resultName] = info.value;\n            context.next = delegate.nextLoc;\n          } else {\n            state = GenStateSuspendedYield;\n            return info;\n          }\n\n          context.delegate = null;\n        }\n\n        if (method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = arg;\n\n        } else if (method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw arg;\n          }\n\n          if (context.dispatchException(arg)) {\n            // If the dispatched exception was caught by a catch block,\n            // then let that catch block handle the exception normally.\n            method = \"next\";\n            arg = undefined;\n          }\n\n        } else if (method === \"return\") {\n          context.abrupt(\"return\", arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          var info = {\n            value: record.arg,\n            done: context.done\n          };\n\n          if (record.arg === ContinueSentinel) {\n            if (context.delegate && method === \"next\") {\n              // Deliberately forget the last sent value so that we don't\n              // accidentally pass it on to the delegate.\n              arg = undefined;\n            }\n          } else {\n            return info;\n          }\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(arg) call above.\n          method = \"throw\";\n          arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.next = finallyEntry.finallyLoc;\n      } else {\n        this.complete(record);\n      }\n\n      return ContinueSentinel;\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = record.arg;\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/regenerator-runtime/runtime.js\n// module id = 2\n// module chunks = 0","import * as crud from './crud'\nimport * as mango from './mango'\nimport * as files from './files'\nimport init from './init'\nimport {promiser, warn} from './utils'\n\nlet filesProto = {\n  create: function (data, options, optCallback) {\n    return promiser(files.create(data, options), optCallback)\n  },\n  createDirectory: function (options, optCallback) {\n    return promiser(files.createDirectory(options), optCallback)\n  },\n  updateById: function (id, data, options, optCallback) {\n    return promiser(files.updateById(id, data, options), optCallback)\n  },\n  updateAttributesById: function (id, attrs, optCallback) {\n    return promiser(files.updateAttributesById(id, attrs), optCallback)\n  },\n  updateAttributesByPath: function (path, attrs, optCallback) {\n    return promiser(files.updateAttributesByPath(path, attrs), optCallback)\n  },\n  trashById: function (id, optCallback) {\n    return promiser(files.trashById(id), optCallback)\n  },\n  statById: function (id, optCallback) {\n    return promiser(files.statById(id), optCallback)\n  },\n  statByPath: function (path, optCallback) {\n    return promiser(files.statByPath(path), optCallback)\n  },\n  downloadById: function (id, optCallback) {\n    return promiser(files.downloadById(id), optCallback)\n  },\n  downloadByPath: function (path, optCallback) {\n    return promiser(files.downloadByPath(path), optCallback)\n  }\n}\n\nlet cozy = {\n  init: function (opts, optCallback) {\n    return promiser(init(opts), optCallback)\n  },\n  // create(doctype, attributes) add a document to the database\n  create: function (doctype, attributes, optCallback) {\n    return promiser(crud.create(doctype, attributes), optCallback)\n  },\n  // find(doctype, id) retrieve a document by its doctype & ID.\n  find: function (doctype, id, optCallback) {\n    return promiser(crud.find(doctype, id), optCallback)\n  },\n  update: function (doctype, doc, changes, optCallback) {\n    return promiser(crud.update(doctype, doc, changes), optCallback)\n  },\n  delete: function (doctype, doc, optCallback) {\n    return promiser(crud._delete(doctype, doc), optCallback)\n  },\n  defineIndex: function (doctype, indexDef, optCallback) {\n    return promiser(mango.defineIndex(doctype, indexDef), optCallback)\n  },\n  query: function (indexRef, query, optCallback) {\n    return promiser(mango.query(indexRef, query), optCallback)\n  },\n  // updateAttributes(doctype, id, changes) performs a patch.\n  updateAttribute: function (doctype, id, changes, optCallback) {\n    return promiser(crud.updateAttributes(doctype, id, changes), optCallback)\n  },\n  // aliased delete to destroy fo browser-sdk compatibility\n  destroy: function (doctype, doc, optCallback) {\n    warn('destroy is deprecated, use cozy.delete instead.')\n    return promiser(crud._delete(doctype, doc), optCallback)\n  },\n\n  files: filesProto\n}\n\nif ((typeof window) !== 'undefined') window.cozy = cozy\n\nexport default cozy\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import {waitConfig, createPath, doFetchJSON, normalizeDoctype} from './utils'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport async function create (doctype, attributes) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  if (config.isV2) attributes.docType = doctype\n\n  let path = createPath(config, doctype)\n  let response = await doFetchJSON(config, 'POST', path, attributes)\n\n  if (config.isV2) return await find(doctype, response._id)\n\n  return response.data\n}\n\nexport async function find (doctype, id) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  if (!id) {\n    throw new Error('Missing id parameter')\n  }\n\n  let path = createPath(config, doctype, id)\n  let response = await doFetchJSON(config, 'GET', path)\n\n  if (config.isV2) Object.assign(response, {_rev: NOREV})\n\n  return response\n}\n\nexport async function update (doctype, doc, changes) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  const {_id, _rev} = doc\n\n  if (!_id) {\n    throw new Error('Missing _id field in passed document')\n  }\n\n  if (!config.isV2 && !_rev) {\n    throw new Error('Missing _rev field in passed document')\n  }\n\n  if (config.isV2) {\n    changes = Object.assign({ _id }, changes)\n  } else {\n    changes = Object.assign({ _id, _rev }, changes)\n  }\n\n  let path = createPath(config, doctype, _id)\n  let response = await doFetchJSON(config, 'PUT', path, changes)\n\n  if (config.isV2) return await find(doctype, _id)\n\n  return response.data\n}\n\nexport async function updateAttributes (doctype, _id, changes, tries = 3) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n  let doc = await find(doctype, _id)\n  let updated = Object.assign({ _id }, doc, changes)\n  try {\n    await update(doctype, doc, updated)\n  } catch (err) {\n    if (tries > 0) updateAttributes(doctype, _id, changes, tries - 1)\n    else throw err\n  }\n}\n\nexport async function _delete (doctype, doc) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  const {_id, _rev} = doc\n\n  if (!_id) {\n    throw new Error('Missing _id field in passed document')\n  }\n\n  if (!config.isV2 && !_rev) {\n    throw new Error('Missing _rev field in passed document')\n  }\n\n  let query = config.isV2 ? null : { rev: _rev }\n  let path = createPath(config, doctype, _id, query)\n  let response = await doFetchJSON(config, 'DELETE', path)\n\n  if (config.isV2) Object.assign(response, {id: _id, rev: NOREV})\n\n  return response\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/crud.js","/* global fetch, btoa */\nimport jsonapi from './jsonapi'\n\nexport let config = {}\n\nexport function configure (opts) {\n  config = opts\n  return config\n}\n\nexport async function waitConfig (opts) {\n  if (opts && opts.nocompat === true && config.isV2) {\n    throw new Error('not implemented on v2')\n  }\n  return config\n}\n\nexport function promiser (promise, optCallback) {\n  if (!optCallback || typeof optCallback !== 'function') {\n    return promise\n  }\n  promise.then(\n    function (result) { optCallback(null, result) },\n    function (err) { optCallback(err, null) }\n  )\n  return null\n}\n\nexport function createPath (config, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!config.isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  if (query) {\n    const q = []\n    for (const qname in query) {\n      q.push(`${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`)\n    }\n    route += `?${q.join('&')}`\n  }\n  return route\n}\n\nexport function doFetch (config, method, path, body) {\n  const options = {method: method, headers: {}}\n\n  if (body !== undefined) {\n    options.headers['Content-Type'] = 'application/json'\n    options.body = JSON.stringify(body)\n  }\n\n  if (config.auth) {\n    let auth = config.auth.appName + ':' + config.auth.token\n    options.headers['Authorization'] = 'Basic ' + btoa(auth)\n  }\n\n  let target = config.target || ''\n  let pathprefix = config.isV2 ? '/ds-api' : ''\n  let fullpath = target + pathprefix + path\n  return fetch(fullpath, options).then((res) => {\n    if (!res.ok) {\n      const contentType = res.headers.get('content-type')\n      let data\n      if (contentType && contentType.indexOf('json') >= 0) {\n        data = res.json().then(err => { throw err })\n      } else {\n        data = res.text()\n      }\n      return data.then(err => { throw err })\n    }\n    return res\n  })\n}\n\nexport function doFetchJSON (config, method, path, body) {\n  return doFetch(config, method, path, body).then((res) => {\n    const contentType = res.headers.get('content-type')\n    const json = res.json()\n    if (contentType && contentType.indexOf('application/vnd.api+json') === 0) {\n      return json.then(jsonapi)\n    } else {\n      return json\n    }\n  })\n}\n\nconst KNOWN_DOCTYPES = {\n  'files': 'io.cozy.files',\n  'folder': 'io.cozy.folders',\n  'contact': 'io.cozy.contacts',\n  'event': 'io.cozy.events',\n  'track': 'io.cozy.labs.music.track',\n  'playlist': 'io.cozy.labs.music.playlist'\n}\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => { REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k })\nexport function normalizeDoctype (config, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (config.isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (config.isV3 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn('you are using a non-qualified doctype ' + doctype + ' assumed to be ' + known)\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\nlet warned = []\nexport function warn (text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.log('Warning', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","function indexKey (doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef (resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource (rawResource, resources) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: rawResource.meta.rev,\n    attributes: rawResource.attributes,\n    relations: (name) => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel (doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach((r) => handleResource(r, resources))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map((r) => handleResource(r, resources))\n  } else {\n    return handleResource(doc.data, resources)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","import {warn, waitConfig, createPath, doFetchJSON, normalizeDoctype} from './utils'\n\nexport async function defineIndex (doctype, fields) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n  if (!Array.isArray(fields) || fields.length === 0) {\n    throw new Error('defineIndex fields should be a non-empty array')\n  }\n  if (config.isV2) return await defineIndexV2(config, doctype, fields)\n  else return await defineIndexV3(config, doctype, fields)\n}\n\nexport async function query (indexRef, options) {\n  const config = await waitConfig()\n\n  if (!indexRef) {\n    throw new Error('query should be passed the indexRef')\n  }\n\n  if (config.isV2) return await queryV2(config, indexRef, options)\n  else return await queryV3(config, indexRef, options)\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = (function (doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER'){\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}).toString().replace(/ /g, '').replace(/\\n/g, '')\nconst COUCHDB_INFINITY = {\"\\uFFFF\": \"\\uFFFF\"}\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nasync function defineIndexV2 (config, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = { map: makeMapFunction(doctype, fields), reduce: '_count' }\n  let path = `/request/${doctype}/${indexName}/`\n  await doFetchJSON(config, 'PUT', path, indexDefinition)\n  return { doctype: doctype, type: 'mapreduce', name: indexName, fields: fields }\n}\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nasync function defineIndexV3 (config, doctype, fields) {\n  let path = createPath(config, doctype, '_index')\n  let indexDefinition = {'index': {fields}}\n  let response = await doFetchJSON(config, 'POST', path, indexDefinition)\n  return { doctype: doctype, type: 'mango', name: response.id, fields: fields }\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nasync function queryV2 (config, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error('query indexRef should be the return value of defineIndexV2')\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  let response = await doFetchJSON(config, 'POST', path, opts)\n  return response.map(r => r.value)\n}\n\n// queryV3 is equivalent to query but only works for V3\nasync function queryV3 (config, indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    since: options.since,\n    sort: indexRef.fields // sort is useless with mango\n  }\n\n  let path = createPath(config, indexRef.doctype, '_find')\n  let response = await doFetchJSON(config, 'POST', path, opts)\n  return response.docs\n}\n\n// misc\nfunction capitalize (name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction (doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace('DOCTYPEPLACEHOLDER', doctype.toLowerCase())\n                     .replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector (selector, path = [], operator = '$eq') {\n  if ((typeof selector) !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function (acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector (selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function (acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector (selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery (indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function (field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error('Selector on field ' + field + ', but not on ' + firstFreeValueField + ' which is higher in index fields.')\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function (field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error('Cant apply selector on ' + field + ', it is not in index')\n    }\n  })\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global fetch Blob File */\nimport {waitConfig, doFetch, doFetchJSON} from './utils'\nimport jsonapi from './jsonapi'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nasync function doUpload (config, data, contentType, method, path) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer = (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer)\n  const isFile = (typeof File !== 'undefined' && data instanceof File)\n  const isBlob = (typeof Blob !== 'undefined' && data instanceof Blob)\n  const isString = (typeof data === 'string')\n\n  if (!isBuffer && !isFile && !isBlob && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType = data.type || contentTypeOctetStream\n    } else if (isBlob) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  const target = config.target || ''\n  return fetch(`${target}${path}`, {\n    method: method,\n    headers: { 'Content-Type': contentType },\n    body: data\n  })\n    .then((res) => {\n      const json = res.json()\n      if (!res.ok) {\n        return json.then(err => { throw err })\n      } else {\n        return json.then(jsonapi)\n      }\n    })\n}\n\nexport async function create (data, options) {\n  const config = await waitConfig({ nocompat: true })\n\n  let {name, dirID, contentType} = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=file`\n  return doUpload(config, data, contentType, 'POST', `${path}${query}`)\n}\n\nexport async function createDirectory (options) {\n  const config = await waitConfig({ nocompat: true })\n\n  let {name, dirID} = options || {}\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return doFetchJSON(config, 'POST', `${path}${query}`)\n}\n\nexport async function updateById (id, data, options) {\n  const config = await waitConfig({ nocompat: true })\n  const {contentType} = options || {}\n  return doUpload(config, data, contentType, 'PUT', `/files/${encodeURIComponent(id)}`)\n}\n\nexport async function updateAttributesById (id, attrs) {\n  const config = await waitConfig({ nocompat: true })\n\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const body = { data: { attributes: attrs } }\n  return doFetchJSON(config, 'PATCH',\n    `/files/${encodeURIComponent(id)}`, body)\n}\n\nexport async function updateAttributesByPath (path, attrs) {\n  const config = await waitConfig({ nocompat: true })\n\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const body = { data: { attributes: attrs } }\n  return doFetchJSON(config, 'PATCH',\n    `/files/metadata?Path=${encodeURIComponent(path)}`, body)\n}\n\nexport async function trashById (id) {\n  const config = await waitConfig({ nocompat: true })\n\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n\n  return doFetchJSON(config, 'DELETE', `/files/${encodeURIComponent(id)}`)\n}\n\nexport async function statById (id) {\n  const config = await waitConfig({ nocompat: true })\n  const res = await doFetchJSON(config, 'GET',\n    `/files/${encodeURIComponent(id)}`)\n  res.isDir = isDir(res)\n  return res\n}\n\nexport async function statByPath (path) {\n  const config = await waitConfig({ nocompat: true })\n  const res = await doFetchJSON(config, 'GET',\n    `/files/metadata?Path=${encodeURIComponent(path)}`)\n  res.isDir = isDir(res)\n  return res\n}\n\nexport async function downloadById (id) {\n  const config = await waitConfig({ nocompat: true })\n  return doFetch(config, 'GET', `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport async function downloadByPath (path) {\n  const config = await waitConfig({ nocompat: true })\n  return doFetch(config, 'GET', `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction isDir (obj) {\n  return obj.attributes.type === 'directory'\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","/* global fetch */\nimport {configure} from './utils'\n\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nfunction getV2Token () {\n  return new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      reject(new Error('getV2Token should be used in modern browser'))\n    } else {\n      const origin = window.location.origin\n      const intent = {action: 'getToken'}\n      let timeout = null\n      const receiver = function (event) {\n        window.removeEventListener('message', receiver)\n        clearTimeout(timeout)\n        resolve({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      }\n      window.addEventListener('message', receiver, false)\n      window.parent.postMessage(intent, origin)\n      timeout = setTimeout(function () {\n        reject(new Error('No response from parent iframe after 3s'))\n      }, V2TOKEN_ABORT_TIMEOUT)\n    }\n  })\n}\n\nasync function getV3Token () {\n  return {appName: 'noauth', token: 'irrelevant'}\n}\n\nasync function isV2 (opts) {\n  let response = await fetch((opts.target || '') + '/status/')\n  let status = await response.json()\n  return status.datasystem !== undefined\n}\n\nasync function getAuth (opts) {\n  opts.isV2 = opts.isV2 || await isV2(opts)\n  if (opts.isV2) return await getV2Token(opts)\n  return await getV3Token(opts)\n}\n\nexport default async function (opts) {\n  opts = opts || {}\n  opts.auth = opts.auth || await getAuth(opts)\n  return configure(opts)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/init.js"],"sourceRoot":""}