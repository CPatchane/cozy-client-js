{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 418bae886f3e989e9ec3","webpack:///./~/whatwg-fetch/fetch.js","webpack:///./~/regenerator-runtime/runtime.js","webpack:///./src/index.js","webpack:///./src/crud.js","webpack:///./src/utils.js","webpack:///./src/mango.js","webpack:///./src/init.js"],"names":["crud","mango","cozy","init","opts","optCallback","create","doctype","attributes","find","id","update","doc","changes","delete","_delete","defineIndex","indexDef","query","indexRef","updateAttribute","updateAttributes","destroy","window","config","isV1","docType","path","response","_id","data","Error","Object","assign","_rev","NOREV","tries","updated","rev","waitConfig","configure","promiser","createPath","doFetch","normalizeDoctype","warn","promise","then","result","err","route","encodeURIComponent","q","qname","push","join","method","body","options","headers","undefined","JSON","stringify","auth","appName","token","btoa","target","pathprefix","fullpath","fetch","res","json","ok","KNOWN_DOCTYPES","REVERSE_KNOWN","keys","forEach","k","isQualified","indexOf","known","replace","isV2","warned","text","console","log","fields","prototype","toString","call","length","defineIndexV1","defineIndexV2","queryV1","queryV2","indexName","map","capitalize","indexDefinition","makeMapFunction","reduce","type","name","makeMapReduceQuery","r","value","use_index","selector","limit","since","sort","docs","parseSelector","normalizeSelector","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","COUCHDB_INFINITY","COUCHDB_LOWEST","charAt","toUpperCase","slice","operator","acc","concat","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","getV2Token","status","datasystem","getV1Token","getAuth","V1TOKEN_ABORT_TIMEOUT","Promise","resolve","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","removeEventListener","clearTimeout","addEventListener","setTimeout"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;ACtCA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;;AAEA;AACA;AACA,yCAAwC,mBAAmB;AAC3D;AACA;;AAEA;AACA;AACA,mCAAkC,oBAAoB;AACtD;AACA;;AAEA;AACA;AACA,yCAAwC,4BAA4B;AACpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA,wDAAuD;AACvD,UAAS;AACT;AACA,UAAS;AACT,+EAA8E;AAC9E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA,wCAAuC,0BAA0B;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,0BAA0B,eAAe;AACxE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA,EAAC;;;;;;;AChbD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAc;AACd,MAAK;AACL,eAAc;AACd;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA,YAAW;AACX;;AAEA;AACA;AACA,yCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,4BAA2B;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAS;AACT;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;;AAEA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kCAAiC,kBAAkB;AACnD;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,kBAAiB;;AAEjB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAwB,iBAAiB;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,aAAY;AACZ;AACA;;AAEA;AACA,aAAY;AACZ;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+CAA8C,QAAQ;AACtD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;;AAEA,YAAW;AACX;AACA;AACA;;AAEA,YAAW;AACX;AACA;AACA;;AAEA,YAAW;AACX;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,+CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3pBA;;KAAYA,I;;AACZ;;KAAYC,K;;AACZ;;;;AACA;;;;;;AAEA,KAAIC,OAAO;AACTC,SAAM,cAAUC,IAAV,EAAgBC,WAAhB,EAA6B;AACjC,YAAO,qBAAS,oBAAKD,IAAL,CAAT,EAAqBC,WAArB,CAAP;AACD,IAHQ;AAIT;AACAC,WAAQ,gBAAUC,OAAV,EAAmBC,UAAnB,EAA+BH,WAA/B,EAA4C;AAClD,YAAO,qBAASL,KAAKM,MAAL,CAAYC,OAAZ,EAAqBC,UAArB,CAAT,EAA2CH,WAA3C,CAAP;AACD,IAPQ;AAQT;AACAI,SAAM,cAAUF,OAAV,EAAmBG,EAAnB,EAAuBL,WAAvB,EAAoC;AACxC,YAAO,qBAASL,KAAKS,IAAL,CAAUF,OAAV,EAAmBG,EAAnB,CAAT,EAAiCL,WAAjC,CAAP;AACD,IAXQ;AAYTM,WAAQ,gBAAUJ,OAAV,EAAmBK,GAAnB,EAAwBC,OAAxB,EAAiCR,WAAjC,EAA8C;AACpD,YAAO,qBAASL,KAAKW,MAAL,CAAYJ,OAAZ,EAAqBK,GAArB,EAA0BC,OAA1B,CAAT,EAA6CR,WAA7C,CAAP;AACD,IAdQ;AAeTS,WAAQ,iBAAUP,OAAV,EAAmBK,GAAnB,EAAwBP,WAAxB,EAAqC;AAC3C,YAAO,qBAASL,KAAKe,OAAL,CAAaR,OAAb,EAAsBK,GAAtB,CAAT,EAAqCP,WAArC,CAAP;AACD,IAjBQ;AAkBTW,gBAAa,qBAAUT,OAAV,EAAmBU,QAAnB,EAA6BZ,WAA7B,EAA0C;AACrD,YAAO,qBAASJ,MAAMe,WAAN,CAAkBT,OAAlB,EAA2BU,QAA3B,CAAT,EAA+CZ,WAA/C,CAAP;AACD,IApBQ;AAqBTa,UAAO,eAAUC,QAAV,EAAoBD,MAApB,EAA2Bb,WAA3B,EAAwC;AAC7C,YAAO,qBAASJ,MAAMiB,KAAN,CAAYC,QAAZ,EAAsBD,MAAtB,CAAT,EAAuCb,WAAvC,CAAP;AACD,IAvBQ;AAwBT;AACAe,oBAAiB,yBAAUb,OAAV,EAAmBG,EAAnB,EAAuBG,OAAvB,EAAgCR,WAAhC,EAA6C;AAC5D,YAAO,qBAASL,KAAKqB,gBAAL,CAAsBd,OAAtB,EAA+BG,EAA/B,EAAmCG,OAAnC,CAAT,EAAsDR,WAAtD,CAAP;AACD,IA3BQ;AA4BT;AACAiB,YAAS,iBAAUf,OAAV,EAAmBK,GAAnB,EAAwBP,WAAxB,EAAqC;AAC5C,sBAAK,iDAAL;AACA,YAAO,qBAASL,KAAKe,OAAL,CAAaR,OAAb,EAAsBK,GAAtB,CAAT,EAAqCP,WAArC,CAAP;AACD;AAhCQ,EAAX;;AAmCA,KAAK,OAAOkB,MAAR,KAAoB,WAAxB,EAAqCA,OAAOrB,IAAP,GAAcA,IAAd;;mBAEtBA,I;;;;;;;;;;;;;;wDCtCR,iBAAuBK,OAAvB,EAAgCC,UAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACCgB,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;;AAEA,iBAAIiB,OAAOC,IAAX,EAAiBjB,WAAWkB,OAAX,GAAqBnB,OAArB;;AAEboB,iBANC,GAMM,uBAAWH,MAAX,EAAmBjB,OAAnB,CANN;AAAA;AAAA,oBAOgB,oBAAQiB,MAAR,EAAgB,MAAhB,EAAwBG,IAAxB,EAA8BnB,UAA9B,CAPhB;;AAAA;AAODoB,qBAPC;;AAAA,kBASDJ,OAAOC,IATN;AAAA;AAAA;AAAA;;AAAA;AAAA,oBASyBhB,KAAKF,OAAL,EAAcqB,SAASC,GAAvB,CATzB;;AAAA;AAAA;;AAAA;AAAA,8CAWED,SAASE,IAXX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAexB,M;;;;;;yDAcf,kBAAqBC,OAArB,EAA8BG,EAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACCc,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;;AAFK,iBAIAG,EAJA;AAAA;AAAA;AAAA;;AAAA,mBAKG,IAAIqB,KAAJ,CAAU,sBAAV,CALH;;AAAA;AAQDJ,iBARC,GAQM,uBAAWH,MAAX,EAAmBjB,OAAnB,EAA4BG,EAA5B,CARN;AAAA;AAAA,oBASgB,oBAAQc,MAAR,EAAgB,KAAhB,EAAuBG,IAAvB,CAThB;;AAAA;AASDC,qBATC;;;AAWL,iBAAIJ,OAAOC,IAAX,EAAiBO,OAAOC,MAAP,CAAcL,QAAd,EAAwB,EAACM,MAAMC,KAAP,EAAxB;;AAXZ,+CAaEP,QAbF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAenB,I;;;;;;yDAgBf,kBAAuBF,OAAvB,EAAgCK,GAAhC,EAAqCC,OAArC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACCW,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;;AAEOsB,gBAJF,GAIejB,GAJf,CAIEiB,GAJF,EAIOK,IAJP,GAIetB,GAJf,CAIOsB,IAJP;;AAAA,iBAMAL,GANA;AAAA;AAAA;AAAA;;AAAA,mBAOG,IAAIE,KAAJ,CAAU,sCAAV,CAPH;;AAAA;AAAA,mBAUD,CAACP,OAAOC,IAAR,IAAgB,CAACS,IAVhB;AAAA;AAAA;AAAA;;AAAA,mBAWG,IAAIH,KAAJ,CAAU,uCAAV,CAXH;;AAAA;;AAcL,iBAAIP,OAAOC,IAAX,EAAiB;AACfZ,yBAAUmB,OAAOC,MAAP,CAAc,EAAEJ,QAAF,EAAd,EAAuBhB,OAAvB,CAAV;AACD,cAFD,MAEO;AACLA,yBAAUmB,OAAOC,MAAP,CAAc,EAAEJ,QAAF,EAAOK,UAAP,EAAd,EAA6BrB,OAA7B,CAAV;AACD;;AAEGc,iBApBC,GAoBM,uBAAWH,MAAX,EAAmBjB,OAAnB,EAA4BsB,GAA5B,CApBN;AAAA;AAAA,oBAqBgB,oBAAQL,MAAR,EAAgB,KAAhB,EAAuBG,IAAvB,EAA6Bd,OAA7B,CArBhB;;AAAA;AAqBDe,qBArBC;;AAAA,kBAuBDJ,OAAOC,IAvBN;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAuByBhB,KAAKF,OAAL,EAAcsB,GAAd,CAvBzB;;AAAA;AAAA;;AAAA;AAAA,+CAyBED,SAASE,IAzBX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAenB,M;;;;;;yDA4Bf,kBAAiCJ,OAAjC,EAA0CsB,GAA1C,EAA+ChB,OAA/C;AAAA,SAAwDuB,KAAxD,uEAAgE,CAAhE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACCZ,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;AAFK;AAAA,oBAGWE,KAAKF,OAAL,EAAcsB,GAAd,CAHX;;AAAA;AAGDjB,gBAHC;AAIDyB,oBAJC,GAISL,OAAOC,MAAP,CAAc,EAAEJ,QAAF,EAAd,EAAuBjB,GAAvB,EAA4BC,OAA5B,CAJT;AAAA;AAAA;AAAA,oBAMGF,OAAOJ,OAAP,EAAgBK,GAAhB,EAAqByB,OAArB,CANH;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,mBAQCD,QAAQ,CART;AAAA;AAAA;AAAA;;AAQYf,8BAAiBd,OAAjB,EAA0BsB,GAA1B,EAA+BhB,OAA/B,EAAwCuB,QAAQ,CAAhD;AARZ;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAef,gB;;;;;;yDAaf,kBAAwBd,OAAxB,EAAiCK,GAAjC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACCY,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;;AAEOsB,gBAJF,GAIejB,GAJf,CAIEiB,GAJF,EAIOK,IAJP,GAIetB,GAJf,CAIOsB,IAJP;;AAAA,iBAMAL,GANA;AAAA;AAAA;AAAA;;AAAA,mBAOG,IAAIE,KAAJ,CAAU,sCAAV,CAPH;;AAAA;AAAA,mBAUD,CAACP,OAAOC,IAAR,IAAgB,CAACS,IAVhB;AAAA;AAAA;AAAA;;AAAA,mBAWG,IAAIH,KAAJ,CAAU,uCAAV,CAXH;;AAAA;AAcDb,kBAdC,GAcOM,OAAOC,IAAP,GAAc,IAAd,GAAqB,EAAEa,KAAKJ,IAAP,EAd5B;AAeDP,iBAfC,GAeM,uBAAWH,MAAX,EAAmBjB,OAAnB,EAA4BsB,GAA5B,EAAiCX,KAAjC,CAfN;AAAA;AAAA,oBAgBgB,oBAAQM,MAAR,EAAgB,QAAhB,EAA0BG,IAA1B,CAhBhB;;AAAA;AAgBDC,qBAhBC;;;AAkBL,iBAAIJ,OAAOC,IAAX,EAAiBO,OAAOC,MAAP,CAAcL,QAAd,EAAwB,EAAClB,IAAImB,GAAL,EAAUS,KAAKH,KAAf,EAAxB;;AAlBZ,+CAoBEP,QApBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAeb,O;;;;;AA3EtB;;;;AAEA,KAAMoB,QAAQ,iBAAd,C;;;;;;;;;;;;;wDCMO,iBAA2B/B,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA,8CACEoB,MADF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAee,U;;;;;SAJNC,S,GAAAA,S;SAQAC,Q,GAAAA,Q;SAWAC,U,GAAAA,U;SAkBAC,O,GAAAA,O;SAkCAC,gB,GAAAA,gB;SAmBAC,I,GAAAA,I;;;;AA9FhB;;AAEO,KAAIrB,0BAAS,EAAb;;AAEA,UAASgB,SAAT,CAAoBpC,IAApB,EAA0B;AAC/B,WAHSoB,MAGT,YAASpB,IAAT;AACD;;AAMM,UAASqC,QAAT,CAAmBK,OAAnB,EAA4BzC,WAA5B,EAAyC;AAC9C,OAAI,CAACA,WAAD,IAAgB,OAAOA,WAAP,KAAuB,UAA3C,EAAuD;AACrD,YAAOyC,OAAP;AACD;AACDA,WAAQC,IAAR,CACE,UAAUC,MAAV,EAAkB;AAAE3C,iBAAY,IAAZ,EAAkB2C,MAAlB;AAA2B,IADjD,EAEE,UAAUC,GAAV,EAAe;AAAE5C,iBAAY4C,GAAZ,EAAiB,IAAjB;AAAwB,IAF3C;AAIA,UAAO,IAAP;AACD;;AAEM,UAASP,UAAT,CAAqBlB,MAArB,EAA6BjB,OAA7B,EAA6D;AAAA,OAAvBG,EAAuB,uEAAlB,EAAkB;AAAA,OAAdQ,KAAc,uEAAN,IAAM;;AAClE,OAAIgC,QAAQ,QAAZ;AACA,OAAI,CAAC1B,OAAOC,IAAZ,EAAkB;AAChByB,cAAYC,mBAAmB5C,OAAnB,CAAZ;AACD;AACD,OAAIG,OAAO,EAAX,EAAe;AACbwC,cAASC,mBAAmBzC,EAAnB,CAAT;AACD;AACD,OAAIQ,KAAJ,EAAW;AACT,SAAMkC,IAAI,EAAV;AACA,UAAK,IAAMC,KAAX,IAAoBnC,KAApB,EAA2B;AACzBkC,SAAEE,IAAF,CAAUH,mBAAmBE,KAAnB,CAAV,SAAuCF,mBAAmBjC,MAAMmC,KAAN,CAAnB,CAAvC;AACD;AACDH,oBAAaE,EAAEG,IAAF,CAAO,GAAP,CAAb;AACD;AACD,UAAOL,KAAP;AACD;;AAEM,UAASP,OAAT,CAAkBnB,MAAlB,EAA0BgC,MAA1B,EAAkC7B,IAAlC,EAAwC8B,IAAxC,EAA8C;AACnD,OAAMC,UAAU,EAACF,QAAQA,MAAT,EAAiBG,SAAS,EAA1B,EAAhB;AACA,OAAIF,SAASG,SAAb,EAAwB;AACtBF,aAAQC,OAAR,CAAgB,cAAhB,IAAkC,kBAAlC;AACAD,aAAQD,IAAR,GAAeI,KAAKC,SAAL,CAAeL,IAAf,CAAf;AACD;AACD,OAAIjC,OAAOuC,IAAX,EAAiB;AACf,SAAIA,OAAOvC,OAAOuC,IAAP,CAAYC,OAAZ,GAAsB,GAAtB,GAA4BxC,OAAOuC,IAAP,CAAYE,KAAnD;AACAP,aAAQC,OAAR,CAAgB,eAAhB,IAAmC,WAAWO,KAAKH,IAAL,CAA9C;AACD;;AAED,OAAII,SAAS3C,OAAO2C,MAAP,IAAiB,EAA9B;AACA,OAAIC,aAAa5C,OAAOC,IAAP,GAAc,SAAd,GAA0B,EAA3C;AACA,OAAI4C,WAAWF,SAASC,UAAT,GAAsBzC,IAArC;AACA,UAAO2C,MAAMD,QAAN,EAAgBX,OAAhB,EAAyBX,IAAzB,CAA8B,UAACwB,GAAD,EAAS;AAC5C,SAAMC,OAAOD,IAAIC,IAAJ,EAAb;AACA,SAAI,CAACD,IAAIE,EAAT,EAAa;AACX,cAAOD,KAAKzB,IAAL,CAAU,eAAO;AAAE,eAAME,GAAN;AAAW,QAA9B,CAAP;AACD,MAFD,MAEO;AACL,cAAOuB,IAAP;AACD;AACF,IAPM,CAAP;AAQD;;AAED,KAAME,iBAAiB;AACrB,YAAS,eADY;AAErB,aAAU,iBAFW;AAGrB,cAAW,kBAHU;AAIrB,YAAS,gBAJY;AAKrB,YAAS,0BALY;AAMrB,eAAY;AANS,EAAvB;AAQA,KAAMC,gBAAgB,EAAtB;AACA3C,QAAO4C,IAAP,CAAYF,cAAZ,EAA4BG,OAA5B,CAAoC,aAAK;AAAEF,iBAAcD,eAAeI,CAAf,CAAd,IAAmCA,CAAnC;AAAsC,EAAjF;AACO,UAASlC,gBAAT,CAA2BpB,MAA3B,EAAmCjB,OAAnC,EAA4C;AACjD,OAAIwE,cAAcxE,QAAQyE,OAAR,CAAgB,GAAhB,MAAyB,CAAC,CAA5C;AACA,OAAIxD,OAAOC,IAAP,IAAesD,WAAnB,EAAgC;AAC9B,SAAIE,QAAQN,cAAcpE,OAAd,CAAZ;AACA,SAAI0E,KAAJ,EAAW,OAAOA,KAAP;AACX,YAAO1E,QAAQ2E,OAAR,CAAgB,KAAhB,EAAuB,GAAvB,CAAP;AACD;AACD,OAAI1D,OAAO2D,IAAP,IAAe,CAACJ,WAApB,EAAiC;AAC/B,SAAIE,SAAQP,eAAenE,OAAf,CAAZ;AACA,SAAI0E,MAAJ,EAAW;AACTpC,YAAK,2CAA2CtC,OAA3C,GAAqD,iBAArD,GAAyE0E,MAA9E;AACA,cAAOA,MAAP;AACD;AACD,WAAM,IAAIlD,KAAJ,CAAU,aAAaxB,OAAb,GAAuB,uBAAjC,CAAN;AACD;AACD,UAAOA,OAAP;AACD;;AAED,KAAI6E,SAAS,EAAb;AACO,UAASvC,IAAT,CAAewC,IAAf,EAAqB;AAC1B,OAAID,OAAOJ,OAAP,CAAeK,IAAf,MAAyB,CAAC,CAA9B,EAAiC;AAC/BD,YAAO9B,IAAP,CAAY+B,IAAZ;AACAC,aAAQC,GAAR,CAAY,SAAZ,EAAuBF,IAAvB;AACD;AACF,E;;;;;;;;;;;;;;;;;;wDCjGM,iBAA4B9E,OAA5B,EAAqCiF,MAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACChE,mBADD;;AAELjB,uBAAU,6BAAiBiB,MAAjB,EAAyBjB,OAAzB,CAAV;;AAFK,mBAGDyB,OAAOyD,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BH,MAA/B,MAA2C,gBAA3C,IACAA,OAAOI,MAAP,KAAkB,CAJjB;AAAA;AAAA;AAAA;;AAAA,mBAKG,IAAI7D,KAAJ,CAAU,gDAAV,CALH;;AAAA;AAAA,kBAODP,OAAOC,IAPN;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAOyBoE,cAAcrE,MAAd,EAAsBjB,OAAtB,EAA+BiF,MAA/B,CAPzB;;AAAA;AAAA;;AAAA;AAAA;AAAA,oBAQaM,cAActE,MAAd,EAAsBjB,OAAtB,EAA+BiF,MAA/B,CARb;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAexE,W;;;;;;yDAWf,kBAAsBG,QAAtB,EAAgCuC,OAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACgB,wBADhB;;AAAA;AACClC,mBADD;;AAAA,iBAGAL,QAHA;AAAA;AAAA;AAAA;;AAAA,mBAIG,IAAIY,KAAJ,CAAU,qCAAV,CAJH;;AAAA;AAAA,kBAODP,OAAOC,IAPN;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAOyBsE,QAAQvE,MAAR,EAAgBL,QAAhB,EAA0BuC,OAA1B,CAPzB;;AAAA;AAAA;;AAAA;AAAA;AAAA,oBAQasC,QAAQxE,MAAR,EAAgBL,QAAhB,EAA0BuC,OAA1B,CARb;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAexC,K;;;;;AAWtB;;AAaA;;AAEA;AACA;;yDACA,kBAA8BM,MAA9B,EAAsCjB,OAAtC,EAA+CiF,MAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AACMS,sBADN,GACkB,OAAOT,OAAOU,GAAP,CAAWC,UAAX,EAAuB5C,IAAvB,CAA4B,EAA5B,CADzB;AAEM6C,4BAFN,GAEwB,EAAEF,KAAKG,gBAAgB9F,OAAhB,EAAyBiF,MAAzB,CAAP,EAAyCc,QAAQ,QAAjD,EAFxB;AAGM3E,iBAHN,iBAGyBpB,OAHzB,SAGoC0F,SAHpC;AAAA;AAAA,oBAIQ,oBAAQzE,MAAR,EAAgB,KAAhB,EAAuBG,IAAvB,EAA6ByE,eAA7B,CAJR;;AAAA;AAAA,+CAKS,EAAE7F,SAASA,OAAX,EAAoBgG,MAAM,WAA1B,EAAuCC,MAAMP,SAA7C,EAAwDT,QAAQA,MAAhE,EALT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAeK,a;;;;;AAQf;AACA;;;;yDACA,kBAA8BrE,MAA9B,EAAsCjB,OAAtC,EAA+CiF,MAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AACM7D,iBADN,GACa,uBAAWH,MAAX,EAAmBjB,OAAnB,EAA4B,QAA5B,CADb;AAEM6F,4BAFN,GAEwB,EAAC,SAAS,EAACZ,cAAD,EAAV,EAFxB;AAAA;AAAA,oBAGuB,oBAAQhE,MAAR,EAAgB,MAAhB,EAAwBG,IAAxB,EAA8ByE,eAA9B,CAHvB;;AAAA;AAGMxE,qBAHN;AAAA,+CAIS,EAAErB,SAASA,OAAX,EAAoBgG,MAAM,OAA1B,EAAmCC,MAAM5E,SAASlB,EAAlD,EAAsD8E,QAAQA,MAA9D,EAJT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAeM,a;;;;;AAOf;AACA;;;;yDACA,kBAAwBtE,MAAxB,EAAgCL,QAAhC,EAA0CuC,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACMvC,SAASoF,IAAT,KAAkB,WADxB;AAAA;AAAA;AAAA;;AAAA,mBAEU,IAAIxE,KAAJ,CAAU,4DAAV,CAFV;;AAAA;AAIE,iBAAI2B,QAAQ8B,MAAZ,EAAoB;AAClB,gCAAK,oCAAL;AACD;;AAEG7D,iBARN,iBAQyBR,SAASZ,OARlC,SAQ6CY,SAASqF,IARtD;AASMpG,iBATN,GASaqG,mBAAmBtF,QAAnB,EAA6BuC,OAA7B,CATb;AAAA;AAAA,oBAUuB,oBAAQlC,MAAR,EAAgB,MAAhB,EAAwBG,IAAxB,EAA8BvB,IAA9B,CAVvB;;AAAA;AAUMwB,qBAVN;AAAA,+CAWSA,SAASsE,GAAT,CAAa;AAAA,sBAAKQ,EAAEC,KAAP;AAAA,cAAb,CAXT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAeZ,O;;;;;AAcf;;;;yDACA,kBAAwBvE,MAAxB,EAAgCL,QAAhC,EAA0CuC,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACMvC,SAASoF,IAAT,KAAkB,OADxB;AAAA;AAAA;AAAA;;AAAA,mBAEU,IAAIxE,KAAJ,CAAU,sDAAV,CAFV;;AAAA;AAKM3B,iBALN,GAKa;AACTwG,0BAAWzF,SAASqF,IADX;AAEThB,uBAAQ9B,QAAQ8B,MAFP;AAGTqB,yBAAUnD,QAAQmD,QAHT;AAITC,sBAAOpD,QAAQoD,KAJN;AAKTC,sBAAOrD,QAAQqD,KALN;AAMTC,qBAAM7F,SAASqE,MANN,CAMa;AANb,cALb;AAcM7D,iBAdN,GAca,uBAAWH,MAAX,EAAmBL,SAASZ,OAA5B,EAAqC,OAArC,CAdb;AAAA;AAAA,oBAeuB,oBAAQiB,MAAR,EAAgB,MAAhB,EAAwBG,IAAxB,EAA8BvB,IAA9B,CAfvB;;AAAA;AAeMwB,qBAfN;AAAA,+CAgBSA,SAASqF,IAhBlB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAejB,O;;;;;AAmBf;;;SAwBgBkB,a,GAAAA,a;SA2BAC,iB,GAAAA,iB;SAuDAV,kB,GAAAA,kB;;AAxMhB;;;;AA0BA,KAAMW,iBAAiB,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,KAAvB,EAA8B,MAA9B,CAAvB;AACA,KAAMC,iBAAiB,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,CAAvB;;AAEA;AACA,KAAMC,eAAgB,UAAU1G,GAAV,EAAe;AACnC,OAAIA,IAAIc,OAAJ,CAAY6F,WAAZ,OAA8B,oBAAlC,EAAuD;AACrDC,UAAKC,iBAAL,EAAwB7G,GAAxB;AACD;AACF,EAJoB,CAIlB8E,QAJkB,GAIPR,OAJO,CAIC,IAJD,EAIO,EAJP,EAIWA,OAJX,CAImB,KAJnB,EAI0B,EAJ1B,CAArB;AAKA,KAAMwC,mBAAmB,EAAC,UAAU,QAAX,EAAzB;AACA,KAAMC,iBAAiB,IAAvB,CA2DA,SAASxB,UAAT,CAAqBK,IAArB,EAA2B;AACzB,UAAOA,KAAKoB,MAAL,CAAY,CAAZ,EAAeC,WAAf,KAA+BrB,KAAKsB,KAAL,CAAW,CAAX,CAAtC;AACD;;AAED,UAASzB,eAAT,CAA0B9F,OAA1B,EAAmCiF,MAAnC,EAA2C;AACzC,OAAIxD,OAAOyD,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BH,MAA/B,MAA2C,gBAA3C,IACAA,OAAOI,MAAP,KAAkB,CADtB,EACyB;AACvB,WAAM,IAAI7D,KAAJ,CAAU,oDAAV,CAAN;AACD;;AAEDyD,YAAS,MAAMA,OAAOU,GAAP,CAAW;AAAA,YAAQ,SAASM,IAAjB;AAAA,IAAX,EAAkCjD,IAAlC,CAAuC,GAAvC,CAAN,GAAoD,GAA7D;;AAEA,UAAO+D,aAAapC,OAAb,CAAqB,oBAArB,EAA2C3E,QAAQgH,WAAR,EAA3C,EACarC,OADb,CACqB,mBADrB,EAC0CM,MAD1C,CAAP;AAED;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACO,UAAS0B,aAAT,CAAwBL,QAAxB,EAA+D;AAAA,OAA7BlF,IAA6B,uEAAtB,EAAsB;AAAA,OAAlBoG,QAAkB,uEAAP,KAAO;;AACpE,OAAI,QAAQlB,QAAR,yCAAQA,QAAR,OAAsB,QAA1B,EAAoC;AAClC,YAAO,CAAC,CAAClF,IAAD,EAAOoG,QAAP,EAAiBlB,QAAjB,CAAD,CAAP;AACD;;AAED,OAAIjC,OAAO5C,OAAO4C,IAAP,CAAYiC,QAAZ,CAAX;AACA,OAAIjC,KAAKgB,MAAL,KAAgB,CAApB,EAAuB;AACrB,WAAM,IAAI7D,KAAJ,CAAU,gBAAV,CAAN;AACD,IAFD,MAEO;AACL,YAAO6C,KAAK0B,MAAL,CAAY,UAAU0B,GAAV,EAAelD,CAAf,EAAkB;AACnC,WAAIuC,eAAerC,OAAf,CAAuBF,CAAvB,MAA8B,CAAC,CAAnC,EAAsC;AACpC,eAAM,IAAI/C,KAAJ,CAAU,iDAAV,CAAN;AACD,QAFD,MAEO,IAAIqF,eAAepC,OAAf,CAAuBF,CAAvB,MAA8B,CAAC,CAAnC,EAAsC;AAC3C,gBAAOkD,IAAIC,MAAJ,CAAWf,cAAcL,SAAS/B,CAAT,CAAd,EAA2BnD,IAA3B,EAAiCmD,CAAjC,CAAX,CAAP;AACD,QAFM,MAEA;AACL,gBAAOkD,IAAIC,MAAJ,CAAWf,cAAcL,SAAS/B,CAAT,CAAd,EAA2BnD,KAAKsG,MAAL,CAAYnD,CAAZ,CAA3B,EAA2C,KAA3C,CAAX,CAAP;AACD;AACF,MARM,EAQJ,EARI,CAAP;AASD;AACF;;AAED;AACA;AACA;AACA;AACA;AACA;AACO,UAASqC,iBAAT,CAA4BN,QAA5B,EAAsC;AAC3C,OAAIqB,UAAUhB,cAAcL,QAAd,CAAd;AACA,UAAOqB,QAAQ5B,MAAR,CAAe,UAAU0B,GAAV,EAAeG,MAAf,EAAuB;AAAA,kCACnBA,MADmB;AAAA,SACtCxG,IADsC;AAAA,SAChCyG,EADgC;AAAA,SAC5BzB,KAD4B;;AAE3C,SAAI0B,QAAQ1G,KAAK4B,IAAL,CAAU,GAAV,CAAZ;AACAyE,SAAIK,KAAJ,IAAaL,IAAIK,KAAJ,KAAc,EAA3B;AACAL,SAAIK,KAAJ,EAAWD,EAAX,IAAiBzB,KAAjB;AACA,YAAOqB,GAAP;AACD,IANM,EAMJ,EANI,CAAP;AAOD;;AAED;AACA;AACA,UAASM,aAAT,CAAwBzB,QAAxB,EAAkCzG,IAAlC,EAAwC;AACtC,OAAIuG,QAAQE,SAAS,KAAT,CAAZ;AACA,OAAI0B,QAAQZ,cAAZ;AACA,OAAIa,QAAQd,gBAAZ;AACA,OAAIe,qBAAJ;;AAEA,OAAI9B,KAAJ,EAAW;AACTvG,UAAKsI,QAAL,CAAcpF,IAAd,CAAmBqD,KAAnB;AACAvG,UAAKuI,MAAL,CAAYrF,IAAZ,CAAiBqD,KAAjB;AACA,YAAO,KAAP;AACD;;AAEDA,WAAQE,SAAS,KAAT,CAAR;AACA,OAAIF,KAAJ,EAAW;AACT,WAAM,IAAI5E,KAAJ,CAAU,kDAAV,CAAN;AACD;;AAED4E,WAAQE,SAAS,MAAT,CAAR;AACA,OAAIF,KAAJ,EAAW;AACT4B,aAAQ5B,KAAR;AACD;;AAEDA,WAAQE,SAAS,MAAT,CAAR;AACA,OAAIF,KAAJ,EAAW;AACT6B,aAAQ7B,KAAR;AACA8B,oBAAe,IAAf;AACD;;AAED9B,WAAQE,SAAS,KAAT,CAAR;AACA,OAAIF,KAAJ,EAAW;AACT6B,aAAQ7B,KAAR;AACA8B,oBAAe,KAAf;AACD;;AAEDrI,QAAKsI,QAAL,CAAcpF,IAAd,CAAmBiF,KAAnB;AACAnI,QAAKuI,MAAL,CAAYrF,IAAZ,CAAiBkF,KAAjB;AACA,OAAIC,iBAAiB7E,SAArB,EAAgCxD,KAAKwI,aAAL,GAAqBH,YAArB;AAChC,UAAO,IAAP;AACD;;AAED;AACA;AACO,UAAShC,kBAAT,CAA6BtF,QAA7B,EAAuCD,KAAvC,EAA8C;AACnD,OAAI2H,UAAU;AACZH,eAAU,EADE;AAEZC,aAAQ,EAFI;AAGZrC,aAAQ;AAHI,IAAd;AAKA,OAAIwC,sBAAsB,IAA1B;AACA,OAAIC,qBAAqB5B,kBAAkBjG,MAAM2F,QAAxB,CAAzB;;AAEA1F,YAASqE,MAAT,CAAgBX,OAAhB,CAAwB,UAAUwD,KAAV,EAAiB;AACvC,SAAIxB,WAAWkC,mBAAmBV,KAAnB,CAAf;;AAEA,SAAIxB,YAAYiC,uBAAuB,IAAvC,EAA6C;AAC3C,aAAM,IAAI/G,KAAJ,CAAU,uBAAuBsG,KAAvB,GAA+B,eAA/B,GAAiDS,mBAAjD,GAAuE,mCAAjF,CAAN;AACD,MAFD,MAEO,IAAIjC,QAAJ,EAAc;AACnBA,gBAASmC,IAAT,GAAgB,IAAhB;AACA,WAAIC,cAAcX,cAAczB,QAAd,EAAwBgC,OAAxB,CAAlB;AACA,WAAII,WAAJ,EAAiBH,sBAAsBT,KAAtB;AAClB,MAJM,MAIA,IAAIS,uBAAuB,IAA3B,EAAiC;AACtCA,6BAAsBT,KAAtB;AACAQ,eAAQF,MAAR,CAAerF,IAAf,CAAoBoE,gBAApB;AACD;AACF,IAbD;;AAeA1F,UAAO4C,IAAP,CAAYmE,kBAAZ,EAAgClE,OAAhC,CAAwC,UAAUwD,KAAV,EAAiB;AACvD,SAAI,CAACU,mBAAmBV,KAAnB,EAA0BW,IAA/B,EAAqC;AACnC,aAAM,IAAIjH,KAAJ,CAAU,4BAA4BsG,KAA5B,GAAoC,sBAA9C,CAAN;AACD;AACF,IAJD;;AAMA,UAAOQ,OAAP;AACD,E;;;;;;;;;;;;;wDCrMD;AAAA;AAAA;AAAA;AAAA;AAAA,8CACS,EAAC7E,SAAS,QAAV,EAAoBC,OAAO,YAA3B,EADT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAeiF,U;;;;;;yDAIf,kBAAqB9I,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACuBkE,MAAM,CAAClE,KAAK+D,MAAL,IAAe,EAAhB,IAAsB,UAA5B,CADvB;;AAAA;AACMvC,qBADN;AAAA;AAAA,oBAEqBA,SAAS4C,IAAT,EAFrB;;AAAA;AAEM2E,mBAFN;AAAA,+CAGSA,OAAOC,UAAP,KAAsBxF,SAH/B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAenC,I;;;;;;yDAMf,kBAAwBrB,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA,4BACcA,KAAKqB,IADnB;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,oBACiCA,KAAKrB,IAAL,CADjC;;AAAA;AAAA;;AAAA;AACEA,kBAAKqB,IADP;;AAAA,kBAEMrB,KAAKqB,IAFX;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAE8B4H,WAAWjJ,IAAX,CAF9B;;AAAA;AAAA;;AAAA;AAAA;AAAA,oBAGe8I,WAAW9I,IAAX,CAHf;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;mBAAekJ,O;;;;;AA3Cf;;4cADA;;;AAGA,KAAMC,wBAAwB,IAA9B;;AAEA,UAASF,UAAT,GAAuB;AACrB,UAAO,IAAIG,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,SAAI,OAAOnI,MAAP,KAAkB,WAAtB,EAAmC;AACjCmI,cAAO,IAAI3H,KAAJ,CAAU,sCAAV,CAAP;AACD,MAFD,MAEO,IAAI,CAACR,OAAOoI,MAAZ,EAAoB;AACzBD,cAAO,IAAI3H,KAAJ,CAAU,qCAAV,CAAP;AACD,MAFM,MAEA,IAAI,CAACR,OAAOoI,MAAP,CAAcC,WAAnB,EAAgC;AACrCF,cAAO,IAAI3H,KAAJ,CAAU,6CAAV,CAAP;AACD,MAFM,MAEA;AAAA;AACL,aAAM8H,SAAStI,OAAOuI,QAAP,CAAgBD,MAA/B;AACA,aAAME,SAAS,EAACC,QAAQ,UAAT,EAAf;AACA,aAAIC,UAAU,IAAd;AACA,aAAMC,WAAW,SAAXA,QAAW,CAAUC,KAAV,EAAiB;AAChC5I,kBAAO6I,mBAAP,CAA2B,SAA3B,EAAsCF,QAAtC;AACAG,wBAAaJ,OAAb;AACAR,mBAAQ;AACNzF,sBAASmG,MAAMrI,IAAN,CAAWkC,OADd;AAENC,oBAAOkG,MAAMrI,IAAN,CAAWmC;AAFZ,YAAR;AAID,UAPD;AAQA1C,gBAAO+I,gBAAP,CAAwB,SAAxB,EAAmCJ,QAAnC,EAA6C,KAA7C;AACA3I,gBAAOoI,MAAP,CAAcC,WAAd,CAA0BG,MAA1B,EAAkCF,MAAlC;AACAI,mBAAUM,WAAW,YAAY;AAC/Bb,kBAAO,IAAI3H,KAAJ,CAAU,yCAAV,CAAP;AACD,UAFS,EAEPwH,qBAFO,CAAV;AAdK;AAiBN;AACF,IAzBM,CAAP;AA0BD;;;yDAkBc,kBAAgBnJ,IAAhB;AAAA;AAAA;AAAA;AAAA;AACbA,oBAAOA,QAAQ,EAAf;AADa,4BAEDA,KAAK2D,IAFJ;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAEkBuF,QAAQlJ,IAAR,CAFlB;;AAAA;AAAA;;AAAA;AAEbA,kBAAK2D,IAFQ;AAAA,+CAGN,sBAAU3D,IAAV,CAHM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I","file":"cozy-client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cozy-client-js\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cozy-client-js\"] = factory();\n\telse\n\t\troot[\"cozy-client-js\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 418bae886f3e989e9ec3","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 1\n// module chunks = 0","/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided, then outerFn.prototype instanceof Generator.\n    var generator = Object.create((outerFn || Generator).prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype;\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] = GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `value instanceof AwaitArgument` to determine if the yielded value is\n  // meant to be awaited. Some may consider the name of this method too\n  // cutesy, but they are curmudgeons.\n  runtime.awrap = function(arg) {\n    return new AwaitArgument(arg);\n  };\n\n  function AwaitArgument(arg) {\n    this.arg = arg;\n  }\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value instanceof AwaitArgument) {\n          return Promise.resolve(value.arg).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof process === \"object\" && process.domain) {\n      invoke = process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          if (method === \"return\" ||\n              (method === \"throw\" && delegate.iterator[method] === undefined)) {\n            // A return or throw (when the delegate iterator has no throw\n            // method) always terminates the yield* loop.\n            context.delegate = null;\n\n            // If the delegate iterator has a return method, give it a\n            // chance to clean up.\n            var returnMethod = delegate.iterator[\"return\"];\n            if (returnMethod) {\n              var record = tryCatch(returnMethod, delegate.iterator, arg);\n              if (record.type === \"throw\") {\n                // If the return method threw an exception, let that\n                // exception prevail over the original return or throw.\n                method = \"throw\";\n                arg = record.arg;\n                continue;\n              }\n            }\n\n            if (method === \"return\") {\n              // Continue with the outer return, now that the delegate\n              // iterator has been terminated.\n              continue;\n            }\n          }\n\n          var record = tryCatch(\n            delegate.iterator[method],\n            delegate.iterator,\n            arg\n          );\n\n          if (record.type === \"throw\") {\n            context.delegate = null;\n\n            // Like returning generator.throw(uncaught), but without the\n            // overhead of an extra function call.\n            method = \"throw\";\n            arg = record.arg;\n            continue;\n          }\n\n          // Delegate generator ran and handled its own exceptions so\n          // regardless of what the method was, we continue as if it is\n          // \"next\" with an undefined arg.\n          method = \"next\";\n          arg = undefined;\n\n          var info = record.arg;\n          if (info.done) {\n            context[delegate.resultName] = info.value;\n            context.next = delegate.nextLoc;\n          } else {\n            state = GenStateSuspendedYield;\n            return info;\n          }\n\n          context.delegate = null;\n        }\n\n        if (method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = arg;\n\n        } else if (method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw arg;\n          }\n\n          if (context.dispatchException(arg)) {\n            // If the dispatched exception was caught by a catch block,\n            // then let that catch block handle the exception normally.\n            method = \"next\";\n            arg = undefined;\n          }\n\n        } else if (method === \"return\") {\n          context.abrupt(\"return\", arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          var info = {\n            value: record.arg,\n            done: context.done\n          };\n\n          if (record.arg === ContinueSentinel) {\n            if (context.delegate && method === \"next\") {\n              // Deliberately forget the last sent value so that we don't\n              // accidentally pass it on to the delegate.\n              arg = undefined;\n            }\n          } else {\n            return info;\n          }\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(arg) call above.\n          method = \"throw\";\n          arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.next = finallyEntry.finallyLoc;\n      } else {\n        this.complete(record);\n      }\n\n      return ContinueSentinel;\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = record.arg;\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/regenerator-runtime/runtime.js\n// module id = 2\n// module chunks = 0","import * as crud from './crud'\nimport * as mango from './mango'\nimport init from './init'\nimport {promiser, warn} from './utils'\n\nlet cozy = {\n  init: function (opts, optCallback) {\n    return promiser(init(opts), optCallback)\n  },\n  // create(doctype, attributes) add a document to the database\n  create: function (doctype, attributes, optCallback) {\n    return promiser(crud.create(doctype, attributes), optCallback)\n  },\n  // find(doctype, id) retrieve a document by its doctype & ID.\n  find: function (doctype, id, optCallback) {\n    return promiser(crud.find(doctype, id), optCallback)\n  },\n  update: function (doctype, doc, changes, optCallback) {\n    return promiser(crud.update(doctype, doc, changes), optCallback)\n  },\n  delete: function (doctype, doc, optCallback) {\n    return promiser(crud._delete(doctype, doc), optCallback)\n  },\n  defineIndex: function (doctype, indexDef, optCallback) {\n    return promiser(mango.defineIndex(doctype, indexDef), optCallback)\n  },\n  query: function (indexRef, query, optCallback) {\n    return promiser(mango.query(indexRef, query), optCallback)\n  },\n  // updateAttributes(doctype, id, changes) performs a patch.\n  updateAttribute: function (doctype, id, changes, optCallback) {\n    return promiser(crud.updateAttributes(doctype, id, changes), optCallback)\n  },\n  // aliased delete to destroy fo browser-sdk compatibility\n  destroy: function (doctype, doc, optCallback) {\n    warn('destroy is deprecated, use cozy.delete instead.')\n    return promiser(crud._delete(doctype, doc), optCallback)\n  }\n}\n\nif ((typeof window) !== 'undefined') window.cozy = cozy\n\nexport default cozy\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import {waitConfig, createPath, doFetch, normalizeDoctype} from './utils'\n\nconst NOREV = 'stack-v1-no-rev'\n\nexport async function create (doctype, attributes) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  if (config.isV1) attributes.docType = doctype\n\n  let path = createPath(config, doctype)\n  let response = await doFetch(config, 'POST', path, attributes)\n\n  if (config.isV1) return await find(doctype, response._id)\n\n  return response.data\n}\n\nexport async function find (doctype, id) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  if (!id) {\n    throw new Error('Missing id parameter')\n  }\n\n  let path = createPath(config, doctype, id)\n  let response = await doFetch(config, 'GET', path)\n\n  if (config.isV1) Object.assign(response, {_rev: NOREV})\n\n  return response\n}\n\nexport async function update (doctype, doc, changes) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  const {_id, _rev} = doc\n\n  if (!_id) {\n    throw new Error('Missing _id field in passed document')\n  }\n\n  if (!config.isV1 && !_rev) {\n    throw new Error('Missing _rev field in passed document')\n  }\n\n  if (config.isV1) {\n    changes = Object.assign({ _id }, changes)\n  } else {\n    changes = Object.assign({ _id, _rev }, changes)\n  }\n\n  let path = createPath(config, doctype, _id)\n  let response = await doFetch(config, 'PUT', path, changes)\n\n  if (config.isV1) return await find(doctype, _id)\n\n  return response.data\n}\n\nexport async function updateAttributes (doctype, _id, changes, tries = 3) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n  let doc = await find(doctype, _id)\n  let updated = Object.assign({ _id }, doc, changes)\n  try {\n    await update(doctype, doc, updated)\n  } catch (err) {\n    if (tries > 0) updateAttributes(doctype, _id, changes, tries - 1)\n    else throw err\n  }\n}\n\nexport async function _delete (doctype, doc) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n\n  const {_id, _rev} = doc\n\n  if (!_id) {\n    throw new Error('Missing _id field in passed document')\n  }\n\n  if (!config.isV1 && !_rev) {\n    throw new Error('Missing _rev field in passed document')\n  }\n\n  let query = config.isV1 ? null : { rev: _rev }\n  let path = createPath(config, doctype, _id, query)\n  let response = await doFetch(config, 'DELETE', path)\n\n  if (config.isV1) Object.assign(response, {id: _id, rev: NOREV})\n\n  return response\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/crud.js","/* global fetch, btoa */\n\nexport let config = {}\n\nexport function configure (opts) {\n  config = opts\n}\n\nexport async function waitConfig (opts) {\n  return config\n}\n\nexport function promiser (promise, optCallback) {\n  if (!optCallback || typeof optCallback !== 'function') {\n    return promise\n  }\n  promise.then(\n    function (result) { optCallback(null, result) },\n    function (err) { optCallback(err, null) }\n  )\n  return null\n}\n\nexport function createPath (config, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!config.isV1) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  if (query) {\n    const q = []\n    for (const qname in query) {\n      q.push(`${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`)\n    }\n    route += `?${q.join('&')}`\n  }\n  return route\n}\n\nexport function doFetch (config, method, path, body) {\n  const options = {method: method, headers: {}}\n  if (body !== undefined) {\n    options.headers['Content-Type'] = 'application/json'\n    options.body = JSON.stringify(body)\n  }\n  if (config.auth) {\n    let auth = config.auth.appName + ':' + config.auth.token\n    options.headers['Authorization'] = 'Basic ' + btoa(auth)\n  }\n\n  let target = config.target || ''\n  let pathprefix = config.isV1 ? '/ds-api' : ''\n  let fullpath = target + pathprefix + path\n  return fetch(fullpath, options).then((res) => {\n    const json = res.json()\n    if (!res.ok) {\n      return json.then(err => { throw err })\n    } else {\n      return json\n    }\n  })\n}\n\nconst KNOWN_DOCTYPES = {\n  'files': 'io.cozy.files',\n  'folder': 'io.cozy.folders',\n  'contact': 'io.cozy.contacts',\n  'event': 'io.cozy.events',\n  'track': 'io.cozy.labs.music.track',\n  'playlist': 'io.cozy.labs.music.playlist'\n}\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => { REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k })\nexport function normalizeDoctype (config, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (config.isV1 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (config.isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn('you are using a non-qualified doctype ' + doctype + ' assumed to be ' + known)\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\nlet warned = []\nexport function warn (text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.log('Warning', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","import {warn, waitConfig, createPath, doFetch, normalizeDoctype} from './utils'\n\nexport async function defineIndex (doctype, fields) {\n  const config = await waitConfig()\n  doctype = normalizeDoctype(config, doctype)\n  if (Object.prototype.toString.call(fields) !== '[object Array]' ||\n      fields.length === 0) {\n    throw new Error('defineIndex fields should be a non-empty array')\n  }\n  if (config.isV1) return await defineIndexV1(config, doctype, fields)\n  else return await defineIndexV2(config, doctype, fields)\n}\n\nexport async function query (indexRef, options) {\n  const config = await waitConfig()\n\n  if (!indexRef) {\n    throw new Error('query should be passed the indexRef')\n  }\n\n  if (config.isV1) return await queryV1(config, indexRef, options)\n  else return await queryV2(config, indexRef, options)\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = (function (doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER'){\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}).toString().replace(/ /g, '').replace(/\\n/g, '')\nconst COUCHDB_INFINITY = {\"\\uFFFF\": \"\\uFFFF\"}\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV1 is equivalent to defineIndex but only works for V1.\n// It transforms the index fields into a map reduce view.\nasync function defineIndexV1 (config, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = { map: makeMapFunction(doctype, fields), reduce: '_count' }\n  let path = `/request/${doctype}/${indexName}/`\n  await doFetch(config, 'PUT', path, indexDefinition)\n  return { doctype: doctype, type: 'mapreduce', name: indexName, fields: fields }\n}\n\n// defineIndexV1 is equivalent to defineIndex but only works for V1.\n// It transforms the index fields into a map reduce view.\nasync function defineIndexV2 (config, doctype, fields) {\n  let path = createPath(config, doctype, '_index')\n  let indexDefinition = {'index': {fields}}\n  let response = await doFetch(config, 'POST', path, indexDefinition)\n  return { doctype: doctype, type: 'mango', name: response.id, fields: fields }\n}\n\n// queryV1 is equivalent to query but only works for V1.\n// It transforms the query into a _views call using makeMapReduceQuery\nasync function queryV1 (config, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error('query indexRef should be the return value of defineIndexV1')\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v1')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  let response = await doFetch(config, 'POST', path, opts)\n  return response.map(r => r.value)\n}\n\n// queryV2 is equivalent to query but only works for V2\nasync function queryV2 (config, indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV2')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    since: options.since,\n    sort: indexRef.fields // sort is useless with mango\n  }\n\n  let path = createPath(config, indexRef.doctype, '_find')\n  let response = await doFetch(config, 'POST', path, opts)\n  return response.docs\n}\n\n// misc\nfunction capitalize (name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction (doctype, fields) {\n  if (Object.prototype.toString.call(fields) !== '[object Array]' ||\n      fields.length === 0) {\n    throw new Error('makeMapFunction fields should be a non-empty array')\n  }\n\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace('DOCTYPEPLACEHOLDER', doctype.toLowerCase())\n                     .replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector (selector, path = [], operator = '$eq') {\n  if ((typeof selector) !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function (acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector (selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function (acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector (selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery (indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function (field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error('Selector on field ' + field + ', but not on ' + firstFreeValueField + ' which is higher in index fields.')\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function (field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error('Cant apply selector on ' + field + ', it is not in index')\n    }\n  })\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global fetch */\nimport {configure} from './utils'\n\nconst V1TOKEN_ABORT_TIMEOUT = 3000\n\nfunction getV1Token () {\n  return new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      reject(new Error('getV1Token should be used in browser'))\n    } else if (!window.parent) {\n      reject(new Error('getV1Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      reject(new Error('getV1Token should be used in modern browser'))\n    } else {\n      const origin = window.location.origin\n      const intent = {action: 'getToken'}\n      let timeout = null\n      const receiver = function (event) {\n        window.removeEventListener('message', receiver)\n        clearTimeout(timeout)\n        resolve({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      }\n      window.addEventListener('message', receiver, false)\n      window.parent.postMessage(intent, origin)\n      timeout = setTimeout(function () {\n        reject(new Error('No response from parent iframe after 3s'))\n      }, V1TOKEN_ABORT_TIMEOUT)\n    }\n  })\n}\n\nasync function getV2Token () {\n  return {appName: 'noauth', token: 'irrelevant'}\n}\n\nasync function isV1 (opts) {\n  let response = await fetch((opts.target || '') + '/status/')\n  let status = await response.json()\n  return status.datasystem !== undefined\n}\n\nasync function getAuth (opts) {\n  opts.isV1 = opts.isV1 || await isV1(opts)\n  if (opts.isV1) return await getV1Token(opts)\n  return await getV2Token(opts)\n}\n\nexport default async function (opts) {\n  opts = opts || {}\n  opts.auth = opts.auth || await getAuth(opts)\n  return configure(opts)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/init.js"],"sourceRoot":""}